<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Dashboard - Dashboard Monitoring Program dan Anggaran - Inspektorat Jenderal Kementrans</title>
    
    <!-- Favicon dan Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="logo/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="logo/logo.png">
    <link rel="shortcut icon" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="144x144" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="120x120" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="114x114" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="76x76" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="72x72" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="60x60" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="57x57" href="logo/logo.png">
    
    <!-- Meta Tags untuk Social Media dan WhatsApp -->
    <meta name="description" content="Executive Dashboard - Monitoring Program dan Anggaran Inspektorat Jenderal Kementerian Transmigrasi. Dashboard strategis untuk pimpinan dengan analisis mendalam coverage program dan kinerja kontrak.">
    <meta name="keywords" content="Executive Dashboard, Itjen, Inspektorat Jenderal, Kementerian Transmigrasi, Monitoring, Anggaran, Analytics, KPI">
    <meta name="author" content="Inspektorat Jenderal Kementerian Transmigrasi">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:title" content="Executive Dashboard - Itjen Kementerian Transmigrasi RI">
    <meta property="og:description" content="Executive Dashboard - Monitoring Program dan Anggaran Inspektorat Jenderal Kementerian Transmigrasi. Dashboard strategis untuk pimpinan dengan analisis mendalam coverage program dan kinerja kontrak.">
    <meta property="og:image" content="logo/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Itjen Kementerian Transmigrasi RI">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="Executive Dashboard - Itjen Kementerian Transmigrasi RI">
    <meta property="twitter:description" content="Dashboard strategis untuk pimpinan dengan analisis mendalam coverage program dan kinerja kontrak.">
    <meta property="twitter:image" content="logo/logo.png">
    
    <!-- WhatsApp Meta Tags -->
    <meta property="og:image:alt" content="Logo Inspektorat Jenderal Kementerian Transmigrasi">
    <meta name="thumbnail" content="logo/logo.png">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800&family=SF+Pro+Text:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <style>
        :root {
            /* Executive Color Palette */
            --primary: #007AFF;
            --secondary: #5856D6;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --info: #5AC8FA;
            --purple: #AF52DE;
            --indigo: #5856D6;
            
            /* Neutral Colors */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F2F2F7;
            --bg-tertiary: #E5E5EA;
            --text-primary: #000000;
            --text-secondary: #6D6D80;
            --text-tertiary: #8E8E93;
            
            /* Gray Scale */
            --gray-1: #8E8E93;
            --gray-2: #AEAEB2;
            --gray-3: #C7C7CC;
            --gray-4: #D1D1D6;
            --gray-5: #E5E5EA;
            --gray-6: #F2F2F7;
            
            /* Spacing */
            --space-1: 2px;
            --space-2: 4px;
            --space-3: 8px;
            --space-4: 12px;
            --space-5: 16px;
            --space-6: 24px;
            --space-7: 32px;
            --space-8: 48px;
            
            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            /* Shadows */
            --shadow-1: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-2: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-3: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-4: 0 20px 25px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Navigation */
        .navbar {
            background: var(--bg-primary);
            padding: var(--space-4) var(--space-6);
            box-shadow: var(--shadow-1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            text-decoration: none;
            color: var(--text-primary);
        }

        .navbar-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .navbar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .btn-action {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-5);
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-action:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        /* Main Container */
        /* World-Class Section Headers */
        .section-header {
            text-align: center;
            margin-bottom: 48px;
            padding: 0 24px;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #1a202c;
            margin: 0 0 8px 0;
            letter-spacing: -0.025em;
        }

        .section-header p {
            color: #64748b;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-6);
        }

        /* Header Section */
        .dashboard-header {
            background: #ffffff;
            color: #1a202c;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-6);
            text-align: center;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: var(--space-3);
        }

        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .dashboard-meta {
            display: flex;
            justify-content: center;
            gap: var(--space-6);
            margin-top: var(--space-6);
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* World-Class Metrics Grid - Single Row Desktop */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
            padding: 0;
        }

        /* Desktop: Force single row with optimal spacing */
        @media (min-width: 1024px) {
            .metrics-grid {
                grid-template-columns: repeat(5, 1fr);
                max-width: 1400px;
                margin-left: auto;
                margin-right: auto;
                margin-bottom: 48px;
                gap: 20px;
            }
        }

        @media (min-width: 1600px) {
            .metrics-grid {
                max-width: 1600px;
                gap: 24px;
            }
        }

        /* Flexible Grid for Coverage & Performance Sections */
        .metrics-grid-flexible {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 48px;
            width: 100%;
            max-width: 100%;
        }

        /* Small Mobile (up to 480px) */
        @media (max-width: 480px) {
            .metrics-grid-flexible {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 32px;
            }
            
            .metrics-grid-flexible .metric-card {
                min-height: 160px;
                padding: 16px 14px;
            }
        }

        /* Mobile (481px to 767px) */
        @media (min-width: 481px) and (max-width: 767px) {
            .metrics-grid-flexible {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: 16px;
            }
        }

        /* Tablet (768px to 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .metrics-grid-flexible {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
            }
        }

        /* Desktop (1024px and up) */
        @media (min-width: 1024px) {
            .metrics-grid-flexible {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 24px;
                max-width: 1400px;
                margin-left: auto;
                margin-right: auto;
            }
        }

        @media (min-width: 1400px) {
            .metrics-grid-flexible {
                max-width: 1600px;
                gap: 28px;
            }
        }

        /* Ensure cards fill available space evenly */
        .metrics-grid-flexible .metric-card {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        /* Special handling for 4-card sections - fallback without :has() */
        .metrics-grid-flexible.four-cards {
            grid-template-columns: repeat(4, 1fr);
        }

        /* Mobile override for 4-card sections */
        @media (max-width: 767px) {
            .metrics-grid-flexible.four-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Tablet override for 4-card sections */
        @media (min-width: 768px) and (max-width: 1023px) {
            .metrics-grid-flexible.four-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Desktop for 4-card sections */
        @media (min-width: 1024px) {
            .metrics-grid-flexible.four-cards {
                grid-template-columns: repeat(4, minmax(280px, 300px));
                justify-content: center;
                gap: 24px;
            }
        }

        @media (min-width: 1400px) {
            .metrics-grid-flexible.four-cards {
                grid-template-columns: repeat(4, minmax(320px, 350px));
                gap: 28px;
            }
        }

        .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 16px;
            padding: 20px 18px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 1px solid #f1f5f9;
            overflow: hidden;
            text-align: center;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.03) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #e2e8f0;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover::after {
            opacity: 1;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .metric-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .metric-icon::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
            pointer-events: none;
        }

        .metric-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 6px;
            line-height: 1.1;
            letter-spacing: -0.025em;
        }

        .metric-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 12px;
            letter-spacing: -0.01em;
        }

        .metric-change {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .metric-breakdown {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .metric-breakdown small {
            color: #64748b;
            font-size: 0.75rem;
            line-height: 1.4;
            display: block;
            margin: 2px 0;
        }
        
        .metric-method {
            margin-top: 4px;
            text-align: center;
        }

        /* Center all calculation explanations */
        .metric-calculation {
            text-align: center !important;
        }

        /* Center coverage bars */
        .coverage-bar {
            margin: 8px auto !important;
        }

        /* Center risk indicator */
        .risk-indicator {
            margin: 8px auto !important;
        }
        
        .metric-method small {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            font-style: italic;
        }

        .change-positive {
            color: var(--success);
        }

        .change-negative {
            color: var(--danger);
        }

        .change-neutral {
            color: var(--text-secondary);
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .chart-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow-2);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: var(--space-1);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .chart-container.large {
            height: 400px;
        }

        /* Regional Performance Grid */
        .regional-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        /* Issues & Alerts */
        .alerts-section {
            margin-bottom: var(--space-6);
        }

        .alerts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
        }

        .alert-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow-2);
        }

        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
            transition: background 0.3s ease;
        }

        .alert-item:hover {
            background: var(--bg-secondary);
        }

        .alert-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: white;
            flex-shrink: 0;
        }

        .alert-content h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--text-primary);
        }

        .alert-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .alert-meta {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-top: var(--space-2);
        }

        /* Progress Indicators */
        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .progress-bg {
            stroke: var(--gray-5);
        }

        .progress-ring .progress-bar {
            stroke: var(--primary);
            stroke-dasharray: 0 283;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dasharray 0.8s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: var(--space-3);
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Mobile Small (max-width: 480px) */
        @media (max-width: 480px) {
            .dashboard-container {
                padding: var(--space-3);
            }

            .dashboard-header {
                padding: var(--space-4) var(--space-3);
            }

            .dashboard-header h1 {
                font-size: 1.75rem;
                line-height: 1.2;
            }

            .dashboard-header p {
                font-size: 0.9rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .metric-card {
                padding: 16px 14px;
                min-height: 140px;
            }

            .metric-value {
                font-size: 1.8rem;
            }

            .metric-label {
                font-size: 0.8rem;
            }

            .metric-icon {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }

            .regional-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .alerts-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .chart-card {
                padding: var(--space-4);
            }

            .dashboard-meta {
                flex-direction: column;
                gap: var(--space-2);
            }

            .navbar-content {
                flex-direction: column;
                gap: var(--space-3);
                padding: var(--space-3);
            }

            .section-header h2 {
                font-size: 1.3rem;
            }

            .section-header p {
                font-size: 0.85rem;
            }
        }

        /* Mobile Medium (481px to 767px) */
        @media (min-width: 481px) and (max-width: 767px) {
            .dashboard-container {
                padding: var(--space-4);
            }

            .dashboard-header {
                padding: var(--space-5) var(--space-4);
            }

            .dashboard-header h1 {
                font-size: 1.9rem;
            }

            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: 16px;
            }

            .regional-grid {
                grid-template-columns: 1fr;
            }

            .alerts-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-meta {
                flex-direction: column;
                gap: var(--space-3);
            }

            .navbar-content {
                flex-direction: column;
                gap: var(--space-4);
            }
        }

        /* Tablet (768px to 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .dashboard-container {
                padding: var(--space-4);
            }

            .dashboard-header {
                padding: var(--space-6) var(--space-4);
            }

            .dashboard-header h1 {
                font-size: 2rem;
            }

            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }

            .regional-grid {
                grid-template-columns: 1fr;
            }

            .alerts-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-5);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: var(--space-3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Badges */
        .status-badge {
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-excellent {
            background: var(--success);
            color: white;
        }

        .status-good {
            background: var(--info);
            color: white;
        }

        .status-warning {
            background: var(--warning);
            color: white;
        }

        .status-critical {
            background: var(--danger);
            color: white;
        }

        /* Trend Indicators */
        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--danger);
        }

        .trend-stable {
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="progress-dashboard.html" class="navbar-brand">
                <div class="navbar-icon">
                    <img src="logo/logo.png" alt="Logo Inspektorat Jenderal" style="width: 100%; height: 100%; object-fit: contain; border-radius: var(--radius-md);">
                </div>
                <div class="navbar-title">Executive Dashboard</div>
            </a>
            
            <div class="navbar-actions">
                <button class="btn-action" onclick="refreshDashboard()">
                    <i class="fas fa-sync-alt"></i>
                    Refresh Data
                </button>
                <a href="progress-dashboard.html" class="btn-action">
                    <i class="fas fa-table"></i>
                    Data Detail
                </a>
                <button class="btn-action" onclick="exportReport()">
                    <i class="fas fa-download"></i>
                    Export
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="dashboard-container">
        <!-- Header Section -->
        <div class="dashboard-header">
            <h1>📊 Executive Dashboard</h1>
            <p>Monitoring Program dan Anggaran Inspektorat Jenderal Kementerian Transmigrasi</p>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #3b82f6; color: white;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                </div>
                <div class="metric-value" id="totalBudget">Rp 0</div>
                <div class="metric-label">Total Anggaran</div>
                <div class="metric-change change-neutral">
                    <i class="fas fa-chart-line"></i>
                    <span id="budgetChange">Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #10b981; color: white;">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                </div>
                <div class="metric-value" id="totalAbsorption">Rp 0</div>
                <div class="metric-label">Total Penyerapan</div>
                <div class="metric-change change-positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="absorptionChange">Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #f59e0b; color: white;">
                        <i class="fas fa-percentage"></i>
                    </div>
                </div>
                <div class="metric-value" id="avgAbsorptionRate">0%</div>
                <div class="metric-label">Rata-rata Penyerapan</div>
                <div class="metric-method">
                    <small id="calculationMethod">Dari nilai kontrak</small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Total Realisasi ÷ Total Nilai Kontrak (jika ada kontrak) atau Total Pagu Anggaran
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #6366f1; color: white;">
                        <i class="fas fa-tasks"></i>
                    </div>
                </div>
                <div class="metric-value" id="totalPrograms">0</div>
                <div class="metric-label">Total Program</div>
                <div class="metric-breakdown">
                    <small>Sudah Kontrak: <span id="programsSudahKontrak">0</span></small><br>
                    <small>Belum Kontrak: <span id="programsBelumKontrak">0</span></small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Jumlah kegiatan dengan nilai kontrak > 0 dianggap "Sudah Kontrak"
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #0ea5e9; color: white;">
                        <i class="fas fa-file-contract"></i>
                    </div>
                </div>
                <div class="metric-value" id="totalKontrak">Rp 0</div>
                <div class="metric-label">Total Kontrak</div>
                <div class="metric-breakdown">
                    <small id="kontrakStatus">Kegiatan berkontrak</small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Penjumlahan nilai kontrak yang benar-benar ada (faktual, tidak estimasi)
                </div>
            </div>
        </div>

        <!-- COVERAGE ANALYSIS SECTION (STRATEGIC OVERSIGHT) -->
        <div class="section-header">
            <div>
                <h2>📊 Cakupan Program & Anggaran</h2>
                <p>Analisis strategis coverage program dan identifikasi gap untuk pengambilan keputusan</p>
            </div>
        </div>

        <div class="metrics-grid-flexible four-cards">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #6b7280; color: white;">
                        <i class="fas fa-tasks"></i>
                    </div>
                </div>
                <div class="metric-value" id="programCoverage">0%</div>
                <div class="metric-label">Cakupan Program</div>
                <div class="metric-breakdown">
                    <small>Terkontrak: <span id="contractedProgramsCount">0</span> dari <span id="totalProgramsCount">0</span></small>
                </div>
                <div class="coverage-bar" style="width: 100%; height: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; margin-top: 8px; overflow: hidden;">
                    <div id="programCoverageBar" style="height: 100%; background: var(--success); width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Program dengan nilai kontrak > 0 dibagi total program
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #6b7280; color: white;">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                </div>
                <div class="metric-value" id="budgetCoverage">0%</div>
                <div class="metric-label">Cakupan Anggaran</div>
                <div class="metric-breakdown">
                    <small>Kontrak: <span id="contractedBudgetAmount">Rp 0</span></small><br>
                    <small>Total Pagu: <span id="totalBudgetAmount">Rp 0</span></small>
                </div>
                <div class="coverage-bar" style="width: 100%; height: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; margin-top: 8px; overflow: hidden;">
                    <div id="budgetCoverageBar" style="height: 100%; background: var(--warning); width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Total nilai kontrak dibagi total pagu anggaran
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #ef4444; color: white;">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                </div>
                <div class="metric-value" id="riskLevel">-</div>
                <div class="metric-label">Status Risiko</div>
                <div class="metric-breakdown">
                    <small id="riskDescription">Evaluating...</small>
                </div>
                <div class="risk-indicator" id="riskIndicator" style="width: 100%; height: 4px; border-radius: 2px; margin-top: 8px; background: var(--text-tertiary);"></div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Berdasarkan: Coverage program & anggaran. AMAN ≥80%, PERHATIAN 60-79%, BERBAHAYA <60%
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #f59e0b; color: white;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="metric-value" id="gapCount">0</div>
                <div class="metric-label">Program Belum Terkontrak</div>
                <div class="metric-breakdown">
                    <small>Nilai: <span id="gapAmount">Rp 0</span></small><br>
                    <small id="urgencyLevel">Urgency: Evaluating</small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Program tanpa kontrak yang perlu segera ditindaklanjuti
                </div>
            </div>
        </div>

        <!-- CONTRACT PERFORMANCE QUALITY METRICS (EXECUTIVE FOCUS) -->
        <div class="section-header">
            <div>
                <h2>🎯 Kualitas Kinerja Kontrak</h2>
                <p>Analisis mendalam untuk kontrak yang sudah berjalan</p>
            </div>
        </div>

        <div class="metrics-grid-flexible four-cards">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #10b981; color: white;">
                        <i class="fas fa-play-circle"></i>
                    </div>
                </div>
                <div class="metric-value" id="contractExecutionRate">0%</div>
                <div class="metric-label">Kontrak Sudah Mulai</div>
                <div class="metric-breakdown">
                    <small>Mulai: <span id="contractsStarted">0</span></small><br>
                    <small>Belum: <span id="contractsNotStarted">0</span></small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Kontrak dengan progress fisik > 0% dibagi total kontrak aktif
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #3b82f6; color: white;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="metric-value" id="avgPhysicalProgress">0%</div>
                <div class="metric-label">Rata-rata Progress Fisik</div>
                <div class="metric-breakdown">
                    <small>Tinggi (≥75%): <span id="highPerformingContracts">0</span></small><br>
                    <small>Rendah (<25%): <span id="lowPerformingContracts">0</span></small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Rata-rata progress fisik semua kontrak yang sedang berjalan
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #10b981; color: white;">
                        <i class="fas fa-coins"></i>
                    </div>
                </div>
                <div class="metric-value" id="avgFinancialEfficiency">0%</div>
                <div class="metric-label">Penyerapan Keuangan</div>
                <div class="metric-breakdown">
                    <small>Tinggi (≥75%): <span id="excellentAbsorption">0</span></small><br>
                    <small>Rendah (<25%): <span id="poorAbsorption">0</span></small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: Persentase dana kontrak yang telah direalisasikan (bukan efisiensi)
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon" style="background: #6366f1; color: white;">
                        <i class="fas fa-trophy"></i>
                    </div>
                </div>
                <div class="metric-value" id="overallContractPerformance">0</div>
                <div class="metric-label">Skor Kinerja Keseluruhan</div>
                <div class="metric-breakdown">
                    <small>Physical (60%) + Financial (40%)</small>
                </div>
                <div class="metric-calculation" style="font-size: 0.7rem; color: var(--text-tertiary); margin-top: 8px; padding: 4px 8px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                    💡 Dihitung dari: (Progress Fisik × 60%) + (Efisiensi Keuangan × 40%)
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
            <!-- Main Trend Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">📈 Trend Penyerapan Anggaran</div>
                        <div class="chart-subtitle">Perkembangan penyerapan anggaran per bulan</div>
                    </div>
                </div>
                <div class="chart-container large">
                    <canvas id="absorptionTrendChart"></canvas>
                </div>
            </div>

            <!-- Progress Overview -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">🎯 Overview Progress</div>
                        <div class="chart-subtitle">Status keseluruhan program</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="progressOverviewChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Regional Performance -->
        <div class="regional-grid">
            <!-- Budget Distribution -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">🗺️ Distribusi Anggaran per Provinsi</div>
                        <div class="chart-subtitle">Top 10 provinsi dengan alokasi terbesar</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="regionalBudgetChart"></canvas>
                </div>
            </div>

            <!-- Physical Progress -->
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">⚡ Progress Fisik Program</div>
                        <div class="chart-subtitle">Distribusi tingkat penyelesaian</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="physicalProgressChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Issues & Alerts and Top Performers sections removed -->
    </div>

    <!-- Load Dependencies -->
    <script src="indonesia-regions-complete.js"></script>
    <script src="satker-data-complete.js"></script>
    <script src="user-auth-system.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, orderBy, enableNetwork } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBcetwoMXOnXuU60WSaUaUce-g1GVSDmWE",
            authDomain: "dashboard-kementrans.firebaseapp.com",
            projectId: "dashboard-kementrans",
            storageBucket: "dashboard-kementrans.firebasestorage.app",
            messagingSenderId: "852941680228",
            appId: "1:852941680228:web:57f9502b71e246ea8e7971",
            measurementId: "G-MRMNSD561Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        enableNetwork(db);

        window.db = db;
        window.auth = auth;
        window.firebase = {
            app, db, auth,
            collection, getDocs, query, orderBy, enableNetwork
        };

        // Skip authentication for executive dashboard - direct data access
        window.firebaseReady = true;
        console.log('🔥 Firebase ready for executive dashboard (no auth required)');
        
        // Dispatch ready event immediately
        setTimeout(() => {
            window.dispatchEvent(new CustomEvent('firebaseReady'));
        }, 100);

        console.log('🔥 Firebase initialized for executive dashboard');
    </script>

    <!-- Dashboard Logic -->
    <script>
        // Global variables
        let progressData = [];
        let charts = {};
        let userAuthSystem = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Executive Dashboard initializing... (VERSION: COVERAGE-ANALYSIS-FIXED-v2)');
            
            try {
                // Use existing global authSystem or create new one
                userAuthSystem = window.authSystem || new UserAuthSystem();
                console.log('✅ Auth system loaded');
            } catch (error) {
                console.warn('⚠️ Auth system not available:', error);
            }

            // Wait for Firebase or start immediately
            if (window.firebaseReady) {
                initializeDashboard();
            } else {
                window.addEventListener('firebaseReady', initializeDashboard);
                // Timeout fallback (reduced to 3 seconds)
                setTimeout(() => {
                    if (!window.firebaseReady) {
                        console.warn('⚠️ Firebase timeout (3s), proceeding with available data');
                        initializeDashboard();
                    }
                }, 3000);
            }
        });

        async function initializeDashboard() {
            try {
                console.log('📊 Executive Dashboard initializing...');
                console.log('🔧 Firebase ready status:', window.firebaseReady);
                console.log('🔧 Database available:', !!window.db);
                
                document.getElementById('dashboardStatus').textContent = 'Status: Loading Data...';
                await loadProgressData();
                console.log('📊 Data loaded, processing metrics...');
                
                document.getElementById('dashboardStatus').textContent = 'Status: Calculating Metrics...';
                updateLastUpdateTime();
                calculateMetrics();
                console.log('📊 Metrics calculated, creating charts...');
                
                document.getElementById('dashboardStatus').textContent = 'Status: Creating Charts...';
                createCharts();
                console.log('📊 Charts created, generating insights...');
                
                document.getElementById('dashboardStatus').textContent = 'Status: Generating Insights...';
                generateInsights();
                
                document.getElementById('dashboardStatus').textContent = 'Status: Ready ✅';
                console.log('✅ Executive dashboard loaded successfully');
                console.log(`📊 Final data count: ${progressData.length} records`);
                
            } catch (error) {
                console.error('❌ Dashboard initialization error:', error);
                console.error('❌ Error stack:', error.stack);
                showFallbackMessage();
            }
        }

        async function loadProgressData() {
            try {
                // Check user permissions first
                const currentUser = userAuthSystem ? userAuthSystem.getCurrentUser() : null;
                let allData = [];
                
                // Try localStorage first
                console.log('📱 Loading data from localStorage...');
                const localData = localStorage.getItem('satker_progress_data');
                if (localData) {
                    allData = JSON.parse(localData);
                    console.log(`✅ Found ${allData.length} records in localStorage`);
                }

                // Try Firebase if localStorage is empty
                if (allData.length === 0 && window.firebaseReady && window.db && window.firebase) {
                    console.log('📡 Loading data from Firebase...');
                    const querySnapshot = await window.firebase.getDocs(
                        window.firebase.query(
                            window.firebase.collection(window.db, 'progress_data'),
                            window.firebase.orderBy('createdAt', 'desc')
                        )
                    );
                    
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        data.firebaseId = doc.id;
                        allData.push(data);
                    });
                    
                    console.log(`✅ Found ${allData.length} records in Firebase`);
                }

                // Filter data based on user permissions
                if (currentUser && userAuthSystem) {
                    if (userAuthSystem.hasPermission('view_all_reports') || userAuthSystem.hasPermission('view_all_satker')) {
                        // Super admin sees all data
                        progressData = allData;
                        console.log(`👑 Super admin: viewing all ${progressData.length} records`);
                        document.getElementById('dataSource').textContent = 'Data Source: All Satkers (Executive View)';
                    } else {
                        // Regular satker admin sees only their own data
                        progressData = allData.filter(item => {
                            // DUAL-ACCESS SYSTEM: Check viewableBy array
                            if (item.viewableBy && Array.isArray(item.viewableBy)) {
                                return item.viewableBy.includes(currentUser.satkerCode) || 
                                       item.viewableBy.includes("ALL");
                            } else {
                                // Fallback untuk data lama tanpa viewableBy
                                return item.satkerCode === currentUser.satkerCode;
                            }
                        });
                        console.log(`👤 Satker admin (${currentUser.satkerCode}): viewing ${progressData.length} own records`);
                        document.getElementById('dataSource').textContent = `Data Source: ${currentUser.satkerName} (Satker View)`;
                        
                        // Check if all data has "ALL" satkerCode - indicates need for regional assignment
                        if (progressData.length === 0 && allData.length > 0) {
                            const allCodes = [...new Set(allData.map(d => d.satkerCode))];
                            if (allCodes.length === 1 && allCodes[0] === 'ALL') {
                                console.log('🚨 DETECTED: All data has satkerCode "ALL" - regional assignment needed!');
                                showDataAssignmentWarning();
                            }
                        }
                    }
                } else {
                    // No auth system, show all data
                    progressData = allData;
                    console.log(`🔓 No auth: viewing all ${progressData.length} records`);
                    document.getElementById('dataSource').textContent = 'Data Source: All Data (Public View)';
                }

                // If no data found, show empty state (no more sample data)
                if (progressData.length === 0) {
                    console.log('📭 No data found in Firebase or localStorage');
                    document.getElementById('dataSource').textContent = 'Data Source: No Data Available';
                    showEmptyState();
                }
                
            } catch (error) {
                console.warn('⚠️ Data loading failed:', error);
                // No fallback to sample data - show empty state
                progressData = [];
                document.getElementById('dataSource').textContent = 'Data Source: Error Loading Data';
                showEmptyState();
            }
        }

        // ===== SMART GETTER FUNCTIONS FOR FIREBASE SYNC =====
        
        // Smart getter untuk Pagu Anggaran (backward compatibility)
        function getPaguAnggaran(item) {
            return parseFloat(item.paguAnggaran || item.nilaiAnggaran) || 0;
        }
        
        // Smart getter untuk Nilai Kontrak (dengan fallback)
        function getNilaiKontrak(item) {
            return parseFloat(item.nilaiKontrak) || getPaguAnggaran(item);
        }
        
        // Smart getter untuk Progress Fisik (handle old/new formats)
        function getProgressFisik(item) {
            if (typeof item.progressFisik === 'number') {
                return item.progressFisik; // New format: exact number
            } else if (typeof item.progressFisik === 'string') {
                // Old format: convert range to middle value
                const rangeMap = {
                    "0": 0, "1-25": 12.5, "26-50": 37.5, 
                    "51-75": 62.5, "76-85": 80, "86-95": 90, "96-100": 98
                };
                return rangeMap[item.progressFisik] || 0;
            }
            return 0;
        }

        function calculateMetrics() {
            if (progressData.length === 0) {
                showEmptyState();
                return;
            }

            // Total Pagu Anggaran (using smart getter)
            const totalBudget = progressData.reduce((sum, item) => {
                return sum + getPaguAnggaran(item);
            }, 0);

            // ✅ FAKTUAL: Total Nilai Kontrak HANYA dari yang benar-benar ada kontrak
            const kegiatanSudahKontrak = progressData.filter(item => {
                const nilaiKontrak = parseFloat(item.nilaiKontrak) || 0;
                return nilaiKontrak > 0;
            });
            
            const totalKontrak = kegiatanSudahKontrak.reduce((sum, item) => {
                return sum + (parseFloat(item.nilaiKontrak) || 0);
            }, 0);

            // Total Absorption/Realisasi
            const totalAbsorption = progressData.reduce((sum, item) => {
                return sum + (parseFloat(item.progressKeuangan) || 0);
            }, 0);

            // 🎯 SMART CALCULATION: Separate tracking untuk akurasi
            let avgAbsorptionRate = 0;
            let calculationMethod = '';
            
            if (totalKontrak > 0) {
                // Ada kontrak → hitung dari nilai kontrak (FAKTUAL)
                avgAbsorptionRate = (totalAbsorption / totalKontrak) * 100;
                calculationMethod = 'from_contract';
            } else if (totalBudget > 0) {
                // Belum ada kontrak → fallback ke pagu anggaran dengan warning
                avgAbsorptionRate = (totalAbsorption / totalBudget) * 100;
                calculationMethod = 'from_budget_fallback';
            } else {
                calculationMethod = 'no_data';
            }

            // Debug calculation (SEPARATE TRACKING)
            console.log('🎯 Executive Dashboard - Separate Tracking (NO MISLEADING):');
            console.log(`📊 Total Programs: ${progressData.length}`);
            console.log(`📊 Programs with Contract: ${kegiatanSudahKontrak.length}`);
            console.log(`📊 Contract Rate: ${((kegiatanSudahKontrak.length / progressData.length) * 100).toFixed(1)}%`);
            console.log(`💰 Total Pagu Anggaran: ${formatCurrency(totalBudget)}`);
            console.log(`📄 Total Nilai Kontrak: ${formatCurrency(totalKontrak)} (FAKTUAL - hanya yang berkontrak)`);
            console.log(`💰 Total Penyerapan: ${formatCurrency(totalAbsorption)}`);
            
            if (calculationMethod === 'from_contract') {
                console.log(`✅ Method: Calculation from contract values`);
                console.log(`📋 Formula: (${totalAbsorption.toLocaleString()} ÷ ${totalKontrak.toLocaleString()}) × 100%`);
                console.log(`✅ Absorption Rate: ${avgAbsorptionRate.toFixed(2)}% (FAKTUAL)`);
            } else if (calculationMethod === 'from_budget_fallback') {
                console.log(`⚠️ Method: Fallback to budget (no contracts yet)`);
                console.log(`📋 Formula: (${totalAbsorption.toLocaleString()} ÷ ${totalBudget.toLocaleString()}) × 100%`);
                console.log(`⚠️ Absorption Rate: ${avgAbsorptionRate.toFixed(2)}% (ESTIMASI)`);
            } else {
                console.log(`❌ Method: Cannot calculate - insufficient data`);
            }

            // 📊 UPDATE UI WITH BREAKDOWN
            document.getElementById('totalBudget').textContent = formatCurrency(totalBudget);
            document.getElementById('totalAbsorption').textContent = formatCurrency(totalAbsorption);
            document.getElementById('avgAbsorptionRate').textContent = avgAbsorptionRate.toFixed(1) + '%';
            
            // Program breakdown
            document.getElementById('totalPrograms').textContent = progressData.length.toLocaleString();
            document.getElementById('programsSudahKontrak').textContent = kegiatanSudahKontrak.length;
            document.getElementById('programsBelumKontrak').textContent = (progressData.length - kegiatanSudahKontrak.length);
            
            // Contract info
            document.getElementById('totalKontrak').textContent = formatCurrency(totalKontrak);
            
            // Method and status indicators
            let methodText = '';
            let statusText = '';
            
            if (calculationMethod === 'from_contract') {
                methodText = 'Dari nilai kontrak';
                statusText = `${kegiatanSudahKontrak.length}/${progressData.length} berkontrak`;
            } else if (calculationMethod === 'from_budget_fallback') {
                methodText = 'Dari pagu anggaran';
                statusText = 'Belum ada kontrak';
            } else {
                methodText = 'Tidak dapat dihitung';
                statusText = 'Data tidak lengkap';
            }
            
            document.getElementById('calculationMethod').textContent = methodText;
            document.getElementById('kontrakStatus').textContent = statusText;
            
            // (Coverage analysis will be called after contract performance calculations below)
            // 🏢 SATKER & REGIONAL INFORMATION
            const uniqueSatkerCount = getUniqueSatkerCount();
            const avgProgramPerSatker = uniqueSatkerCount > 0 ? (progressData.length / uniqueSatkerCount).toFixed(1) : 0;
            
            document.getElementById('totalSatker').innerHTML = `
                <div style="font-size: 1rem; font-weight: 600; margin-bottom: 4px;">${uniqueSatkerCount}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary); opacity: 0.8;">
                    Rata-rata ${avgProgramPerSatker} program/satker
                </div>
            `;
            
            console.log(`🏢 Satker Analysis: ${uniqueSatkerCount} satker, avg ${avgProgramPerSatker} program/satker`);
            
            // 📈 CALCULATE KEY RATES FOR EXECUTIVE SUMMARY
            const contractRate = progressData.length > 0 ? (kegiatanSudahKontrak.length / progressData.length) * 100 : 0;
            const budgetUtilization = totalBudget > 0 ? (totalAbsorption / totalBudget) * 100 : 0;
            
            // 🎯 CONTRACT PERFORMANCE QUALITY ANALYSIS (EXECUTIVE FOCUS)
            let contractsStarted = 0;
            let contractsNotStarted = 0;
            let highPerformingContracts = 0;
            let lowPerformingContracts = 0;
            let excellentAbsorption = 0;
            let poorAbsorption = 0;
            
            let totalPhysicalProgress = 0;
            // ✅ FIXED: Use weighted totals instead of percentage average
            let totalRealisasiForEfficiency = 0;
            let totalKontrakForEfficiency = 0;
            // Contract performance tracking for internal calculations
            
            console.log('🎯 Starting Contract Performance Analysis...');
            console.log(`📊 Total programs: ${progressData.length}`);
            console.log(`📄 Programs with contracts: ${kegiatanSudahKontrak.length}`);
            
            kegiatanSudahKontrak.forEach(item => {
                const physicalProgress = getProgressFisik(item);
                const nilaiKontrak = parseFloat(item.nilaiKontrak) || 0;
                const realisasi = parseFloat(item.progressKeuangan) || 0;
                const financialAbsorption = nilaiKontrak > 0 ? (realisasi / nilaiKontrak) * 100 : 0;
                
                // Contract execution status
                if (physicalProgress > 0) {
                    contractsStarted++;
                } else {
                    contractsNotStarted++;
                }
                
                // Physical performance quality
                if (physicalProgress >= 75) {
                    highPerformingContracts++;
                } else if (physicalProgress < 25) {
                    lowPerformingContracts++;
                }
                
                // Financial absorption level
                if (financialAbsorption >= 75) {
                    excellentAbsorption++;
                } else if (financialAbsorption < 25) {
                    poorAbsorption++;
                }
                
                totalPhysicalProgress += physicalProgress;
                // ✅ FIXED: Accumulate weighted totals for proper average
                totalRealisasiForEfficiency += realisasi;
                totalKontrakForEfficiency += nilaiKontrak;
                
                // Performance data calculated for metrics (removed detailed storage)
            });
            
            // Calculate averages for contracted programs only (AFTER loop completes)
            const avgPhysicalProgress = kegiatanSudahKontrak.length > 0 ? totalPhysicalProgress / kegiatanSudahKontrak.length : 0;
            // ✅ FIXED: Use weighted average for financial absorption (not efficiency)
            const avgFinancialAbsorption = totalKontrakForEfficiency > 0 ? (totalRealisasiForEfficiency / totalKontrakForEfficiency) * 100 : 0;
            const contractExecutionRate = kegiatanSudahKontrak.length > 0 ? (contractsStarted / kegiatanSudahKontrak.length) * 100 : 0;
            
            // Overall contract performance score
            const overallContractPerformance = (avgPhysicalProgress * 0.6) + (avgFinancialAbsorption * 0.4);
            
            // 🎯 UPDATE CONTRACT PERFORMANCE QUALITY METRICS (NOW THAT ALL VARIABLES ARE READY)
            const updateElement = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                } else {
                    console.warn(`⚠️ Element not found: ${id}`);
                }
            };
            
            updateElement('contractExecutionRate', contractExecutionRate.toFixed(1) + '%');
            updateElement('contractsStarted', contractsStarted);
            updateElement('contractsNotStarted', contractsNotStarted);
            
            updateElement('avgPhysicalProgress', avgPhysicalProgress.toFixed(1) + '%');
            updateElement('highPerformingContracts', highPerformingContracts);
            updateElement('lowPerformingContracts', lowPerformingContracts);
            
            updateElement('avgFinancialEfficiency', avgFinancialAbsorption.toFixed(1) + '%');
            updateElement('excellentAbsorption', excellentAbsorption);
            updateElement('poorAbsorption', poorAbsorption);
            
            updateElement('overallContractPerformance', overallContractPerformance.toFixed(0) + '/100');
            
            // 🎨 COLOR CODING BASED ON PERFORMANCE
            const contractExecCard = document.getElementById('contractExecutionRate');
            const physicalCard = document.getElementById('avgPhysicalProgress');
            const financialCard = document.getElementById('avgFinancialEfficiency');
            const overallCard = document.getElementById('overallContractPerformance');
            
            if (contractExecCard && contractExecCard.parentElement) {
                if (contractExecutionRate >= 80) {
                    contractExecCard.parentElement.style.borderLeft = '4px solid var(--success)';
                } else if (contractExecutionRate >= 50) {
                    contractExecCard.parentElement.style.borderLeft = '4px solid var(--warning)';
                } else {
                    contractExecCard.parentElement.style.borderLeft = '4px solid var(--danger)';
                }
            }
            
            if (physicalCard && physicalCard.parentElement) {
                if (avgPhysicalProgress >= 70) {
                    physicalCard.parentElement.style.borderLeft = '4px solid var(--success)';
                } else if (avgPhysicalProgress >= 40) {
                    physicalCard.parentElement.style.borderLeft = '4px solid var(--warning)';
                } else {
                    physicalCard.parentElement.style.borderLeft = '4px solid var(--danger)';
                }
            }
            
            if (financialCard && financialCard.parentElement) {
                if (avgFinancialAbsorption >= 75) {
                    financialCard.parentElement.style.borderLeft = '4px solid var(--success)';
                } else if (avgFinancialAbsorption >= 50) {
                    financialCard.parentElement.style.borderLeft = '4px solid var(--warning)';
                } else {
                    financialCard.parentElement.style.borderLeft = '4px solid var(--danger)';
                }
            }
            
            if (overallCard && overallCard.parentElement) {
                if (overallContractPerformance >= 75) {
                    overallCard.parentElement.style.borderLeft = '4px solid var(--success)';
                } else if (overallContractPerformance >= 50) {
                    overallCard.parentElement.style.borderLeft = '4px solid var(--warning)';
                } else {
                    overallCard.parentElement.style.borderLeft = '4px solid var(--danger)';
                }
            }
            
            console.log('🎯 CONTRACT PERFORMANCE QUALITY ANALYSIS:');
            console.log(`📋 Contracts Started: ${contractsStarted}/${kegiatanSudahKontrak.length} (${contractExecutionRate.toFixed(1)}%)`);
            console.log(`📊 Avg Physical Progress: ${avgPhysicalProgress.toFixed(1)}%`);
            console.log(`💰 Financial Absorption (FIXED): ${totalRealisasiForEfficiency.toLocaleString()} / ${totalKontrakForEfficiency.toLocaleString()} = ${avgFinancialAbsorption.toFixed(1)}%`);
            console.log(`🏆 Overall Performance Score: ${overallContractPerformance.toFixed(1)}/100`);
            console.log(`✅ High Performing Contracts: ${highPerformingContracts}`);
            console.log(`⚠️ Low Performing Contracts: ${lowPerformingContracts}`);
            console.log(`💎 High Absorption: ${excellentAbsorption}`);
            console.log(`🔴 Low Absorption: ${poorAbsorption}`);
            
            // 📊 COVERAGE ANALYSIS CALCULATIONS (INLINE TO AVOID SCOPE ISSUES)
            console.log('📊 Starting Coverage Analysis... (INLINE VERSION)');
            
            // Calculate coverage metrics inline to avoid scope issues
            const totalPrograms_coverage = progressData.length;
            const kegiatanSudahKontrak_coverage = progressData.filter(item => {
                const nilaiKontrak = parseFloat(item.nilaiKontrak) || 0;
                return nilaiKontrak > 0;
            });
            const contractedPrograms_coverage = kegiatanSudahKontrak_coverage.length;
            const uncontractedPrograms_coverage = totalPrograms_coverage - contractedPrograms_coverage;
            
            // Calculate totals
            const totalBudget_coverage = progressData.reduce((sum, item) => sum + getPaguAnggaran(item), 0);
            const totalKontrak_coverage = kegiatanSudahKontrak_coverage.reduce((sum, item) => sum + (parseFloat(item.nilaiKontrak) || 0), 0);
            const gapAmount_coverage = totalBudget_coverage - totalKontrak_coverage;
            
            // Coverage percentages
            const programCoverage = totalPrograms_coverage > 0 ? (contractedPrograms_coverage / totalPrograms_coverage) * 100 : 0;
            const budgetCoverage = totalBudget_coverage > 0 ? (totalKontrak_coverage / totalBudget_coverage) * 100 : 0;
            
            // Risk assessment
            let riskLevel = 'AMAN';
            let riskColor = 'var(--success)';
            let riskDescription = 'Coverage memadai';
            
            if (programCoverage < 60 || budgetCoverage < 60) {
                riskLevel = 'BERBAHAYA';
                riskColor = 'var(--danger)';
                riskDescription = 'Coverage rendah, perlu tindakan segera';
            } else if (programCoverage < 80 || budgetCoverage < 80) {
                riskLevel = 'PERHATIAN';
                riskColor = 'var(--warning)';
                riskDescription = 'Coverage perlu ditingkatkan';
            }
            
            // Urgency assessment
            let urgencyLevel = 'RENDAH';
            if (uncontractedPrograms_coverage > totalPrograms_coverage * 0.4) {
                urgencyLevel = 'TINGGI';
            } else if (uncontractedPrograms_coverage > totalPrograms_coverage * 0.2) {
                urgencyLevel = 'SEDANG';
            }
            
            // Update Coverage UI elements
            const updateCoverageElement = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                } else {
                    console.warn(`⚠️ Coverage element not found: ${id}`);
                }
            };
            
            // Program Coverage
            updateCoverageElement('programCoverage', programCoverage.toFixed(1) + '%');
            updateCoverageElement('contractedProgramsCount', contractedPrograms_coverage);
            updateCoverageElement('totalProgramsCount', totalPrograms_coverage);
            
            // Budget Coverage
            updateCoverageElement('budgetCoverage', budgetCoverage.toFixed(1) + '%');
            updateCoverageElement('contractedBudgetAmount', formatCurrency(totalKontrak_coverage));
            updateCoverageElement('totalBudgetAmount', formatCurrency(totalBudget_coverage));
            
            // Risk Level
            updateCoverageElement('riskLevel', riskLevel);
            updateCoverageElement('riskDescription', riskDescription);
            
            // Gap Analysis
            updateCoverageElement('gapCount', uncontractedPrograms_coverage);
            updateCoverageElement('gapAmount', formatCurrency(gapAmount_coverage));
            updateCoverageElement('urgencyLevel', `Urgency: ${urgencyLevel}`);
            
            // Update progress bars
            const programBar = document.getElementById('programCoverageBar');
            const budgetBar = document.getElementById('budgetCoverageBar');
            const riskIndicator = document.getElementById('riskIndicator');
            
            if (programBar) {
                programBar.style.width = programCoverage.toFixed(1) + '%';
                programBar.style.background = programCoverage >= 80 ? 'var(--success)' : 
                                            programCoverage >= 60 ? 'var(--warning)' : 'var(--danger)';
            }
            
            if (budgetBar) {
                budgetBar.style.width = budgetCoverage.toFixed(1) + '%';
                budgetBar.style.background = budgetCoverage >= 80 ? 'var(--success)' : 
                                           budgetCoverage >= 60 ? 'var(--warning)' : 'var(--danger)';
            }
            
            if (riskIndicator) {
                riskIndicator.style.background = riskColor;
            }
            
            // Console logging for debugging
            console.log('📊 COVERAGE ANALYSIS RESULTS (INLINE):');
            console.log(`📋 Program Coverage: ${contractedPrograms_coverage}/${totalPrograms_coverage} (${programCoverage.toFixed(1)}%)`);
            console.log(`💰 Budget Coverage: ${formatCurrency(totalKontrak_coverage)}/${formatCurrency(totalBudget_coverage)} (${budgetCoverage.toFixed(1)}%)`);
            console.log(`🚨 Risk Level: ${riskLevel} - ${riskDescription}`);
            console.log(`⚠️ Gap: ${uncontractedPrograms_coverage} programs, ${formatCurrency(gapAmount_coverage)} - Urgency: ${urgencyLevel}`);
            
            // Performance indicators for executives
            const performanceIndicators = {
                budgetEfficiency: totalKontrak > 0 ? (totalKontrak / totalBudget) * 100 : 0,
                contractEfficiency: totalKontrak > 0 ? (totalAbsorption / totalKontrak) * 100 : 0,
                overallProgress: budgetUtilization,
                contractProgress: contractRate
            };
            
            // Rate status for executives
            let rateStatus = '';
            let rateColor = '';
            if (avgAbsorptionRate >= 75) {
                rateStatus = '✅ Sangat Baik';
                rateColor = 'var(--success)';
            } else if (avgAbsorptionRate >= 50) {
                rateStatus = '🟡 Baik';
                rateColor = 'var(--info)';
            } else if (avgAbsorptionRate >= 25) {
                rateStatus = '🟠 Perlu Perhatian';
                rateColor = 'var(--warning)';
            } else {
                rateStatus = '🔴 Perlu Tindakan';
                rateColor = 'var(--danger)';
            }
            
            // 📋 GENERATE EXECUTIVE SUMMARY
            generateExecutiveSummary({
                totalPrograms: progressData.length,
                contractedPrograms: kegiatanSudahKontrak.length,
                contractRate,
                budgetUtilization,
                avgAbsorptionRate,
                totalBudget,
                totalKontrak,
                totalAbsorption,
                uniqueSatkerCount,
                performanceStatus: rateStatus,
                calculationMethod
            });
            
            // 🎨 VISUAL INDICATORS
            const avgRateElement = document.getElementById('avgAbsorptionRate');
            const methodElement = document.getElementById('calculationMethod');
            
            if (calculationMethod === 'from_contract') {
                avgRateElement.style.color = '#10b981'; // Green for factual
                methodElement.style.color = 'rgba(16, 185, 129, 0.8)';
            } else if (calculationMethod === 'from_budget_fallback') {
                avgRateElement.style.color = '#f59e0b'; // Orange for fallback
                methodElement.style.color = 'rgba(245, 158, 11, 0.8)';
            } else {
                avgRateElement.style.color = '#ef4444'; // Red for error
                methodElement.style.color = 'rgba(239, 68, 68, 0.8)';
            }

            // 📈 CALCULATE EXECUTIVE-LEVEL TRENDS & KPIs
            // (contractRate and budgetUtilization already calculated above)
            
            // Executive-friendly change indicators (using pre-calculated values)
            document.getElementById('budgetChange').innerHTML = `
                <span style="font-size: 0.75rem; color: var(--text-secondary);">
                    Utilisasi: ${budgetUtilization.toFixed(1)}%
                </span>`;
                
            document.getElementById('absorptionChange').innerHTML = `
                <span style="color: ${totalAbsorption > 0 ? 'var(--success)' : 'var(--warning)'}; font-size: 0.75rem;">
                    ${totalAbsorption > 0 ? '✓ Ada realisasi' : '⚠️ Belum ada realisasi'}
                </span>`;
            // Program status for executives
            let programStatus = '';
            if (contractRate >= 80) {
                programStatus = '✅ Mayoritas Terkontrak';
            } else if (contractRate >= 50) {
                programStatus = '🟡 Sebagian Terkontrak';
            } else if (contractRate > 0) {
                programStatus = '🟠 Sedikit Terkontrak';
            } else {
                programStatus = '🔴 Belum Ada Kontrak';
            }
            
            // Update executive indicators
            const rateChangeElement = document.getElementById('rateChange');
            if (rateChangeElement) {
                rateChangeElement.innerHTML = `<span style="color: ${rateColor}; font-size: 0.75rem;">${rateStatus}</span>`;
            }
            
            const programChangeElement = document.getElementById('programChange');
            if (programChangeElement) {
                programChangeElement.innerHTML = `<span style="font-size: 0.75rem; color: var(--text-secondary);">${programStatus}</span>`;
            }
            
            // 📈 EXECUTIVE SUMMARY LOGGING
            console.log('🎯 EXECUTIVE DASHBOARD - KEY INDICATORS:');
            console.log(`📈 Budget Utilization: ${budgetUtilization.toFixed(1)}%`);
            console.log(`📄 Contract Rate: ${contractRate.toFixed(1)}%`);
            console.log(`🎯 Performance Status: ${rateStatus}`);
            console.log(`📈 Program Status: ${programStatus}`);
            console.log(`📊 Efficiency Indicators:`, performanceIndicators);
        }

        function createCharts() {
            createAbsorptionTrendChart();
            createProgressOverviewChart();
            createRegionalBudgetChart();
            createPhysicalProgressChart();
        }

        function createAbsorptionTrendChart() {
            const ctx = document.getElementById('absorptionTrendChart').getContext('2d');
            
            // Generate monthly trend data
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const currentMonth = new Date().getMonth();
            const visibleMonths = months.slice(0, currentMonth + 1);
            
            const budgetData = visibleMonths.map((month, index) => {
                const monthProgress = progressData.filter(item => {
                    const itemDate = new Date(item.createdAt || item.submittedAt);
                    return itemDate.getMonth() <= index;
                });
                return monthProgress.reduce((sum, item) => sum + getPaguAnggaran(item), 0) / 1000000; // Dalam jutaan
            });

            const absorptionData = visibleMonths.map((month, index) => {
                const monthProgress = progressData.filter(item => {
                    const itemDate = new Date(item.createdAt || item.submittedAt);
                    return itemDate.getMonth() <= index;
                });
                return monthProgress.reduce((sum, item) => sum + (parseFloat(item.progressKeuangan) || 0), 0) / 1000000; // Dalam jutaan
            });

            charts.absorptionTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: visibleMonths,
                    datasets: [{
                        label: 'Target Anggaran',
                        data: budgetData,
                        borderColor: '#007AFF',
                        backgroundColor: 'rgba(0, 122, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Realisasi Penyerapan',
                        data: absorptionData,
                        borderColor: '#34C759',
                        backgroundColor: 'rgba(52, 199, 89, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah (Jutaan Rp)'
                            }
                        }
                    }
                }
            });
        }

        function createProgressOverviewChart() {
            const ctx = document.getElementById('progressOverviewChart').getContext('2d');
            
            // Categorize by physical progress
            const progressCategories = {
                'Belum Mulai (0%)': 0,
                'Perencanaan (1-25%)': 0,
                'Pelaksanaan (26-75%)': 0,
                'Hampir Selesai (76-99%)': 0,
                'Selesai (100%)': 0
            };

            progressData.forEach(item => {
                const physicalProgress = getProgressFisik(item); // Using smart getter
                if (physicalProgress === 0) {
                    progressCategories['Belum Mulai (0%)']++;
                } else if (physicalProgress <= 25) {
                    progressCategories['Perencanaan (1-25%)']++;
                } else if (physicalProgress <= 75) {
                    progressCategories['Pelaksanaan (26-75%)']++;
                } else if (physicalProgress < 100) {
                    progressCategories['Hampir Selesai (76-99%)']++;
                } else {
                    progressCategories['Selesai (100%)']++;
                }
            });

            charts.progressOverview = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(progressCategories),
                    datasets: [{
                        data: Object.values(progressCategories),
                        backgroundColor: [
                            '#FF3B30',
                            '#FF9500',
                            '#007AFF',
                            '#5AC8FA',
                            '#34C759'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        function createRegionalBudgetChart() {
            const ctx = document.getElementById('regionalBudgetChart').getContext('2d');
            
            // Group by province
            const provinceBudgets = {};
            progressData.forEach(item => {
                const province = item.provinsi || 'Unknown';
                if (!provinceBudgets[province]) {
                    provinceBudgets[province] = 0;
                }
                provinceBudgets[province] += getPaguAnggaran(item);
            });

            // Get top 10 provinces
            const sortedProvinces = Object.entries(provinceBudgets)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            charts.regionalBudget = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedProvinces.map(([province]) => province),
                    datasets: [{
                        label: 'Alokasi Anggaran (Jutaan Rp)',
                        data: sortedProvinces.map(([, budget]) => budget / 1000000),
                        backgroundColor: '#007AFF',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createPhysicalProgressChart() {
            const ctx = document.getElementById('physicalProgressChart').getContext('2d');
            
            // Progress distribution
            const progressRanges = {
                '0%': 0,
                '1-25%': 0,
                '26-50%': 0,
                '51-75%': 0,
                '76-99%': 0,
                '100%': 0
            };

            progressData.forEach(item => {
                const progress = getProgressFisik(item); // Using smart getter
                if (progress === 0) progressRanges['0%']++;
                else if (progress <= 25) progressRanges['1-25%']++;
                else if (progress <= 50) progressRanges['26-50%']++;
                else if (progress <= 75) progressRanges['51-75%']++;
                else if (progress < 100) progressRanges['76-99%']++;
                else progressRanges['100%']++;
            });

            charts.physicalProgress = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(progressRanges),
                    datasets: [{
                        label: 'Number of Programs',
                        data: Object.values(progressRanges),
                        backgroundColor: [
                            '#FF3B30',
                            '#FF9500', 
                            '#FFCC00',
                            '#007AFF',
                            '#5AC8FA',
                            '#34C759'
                        ],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function generateInsights() {
            // generateCriticalIssues(); // DISABLED - UI section removed
            // generateTopPerformers(); // DISABLED - UI section removed
            console.log('📊 Insights generation disabled - UI sections removed');
        }

        /* DISABLED - generateCriticalIssues function (UI section removed)
        function generateCriticalIssues() {
            const container = document.getElementById('criticalIssues');
            
            // Find critical issues
            const issues = [];
            
            // Low absorption rate
            const lowAbsorptionItems = progressData.filter(item => {
                const rate = parseFloat(item.persentasePenyerapan?.toString().replace('%', '') || 0);
                return rate < 30 && rate > 0;
            });
            
            if (lowAbsorptionItems.length > 0) {
                issues.push({
                    type: 'critical',
                    title: 'Penyerapan Anggaran Rendah',
                    description: `${lowAbsorptionItems.length} program memiliki penyerapan <30%`,
                    meta: 'Requires immediate attention'
                });
            }

            // Stalled projects (0% physical progress)
            const stalledProjects = progressData.filter(item => {
                const progress = getProgressFisik(item); // Using smart getter
                return progress === 0;
            });

            if (stalledProjects.length > 0) {
                issues.push({
                    type: 'warning',
                    title: 'Program Belum Dimulai',
                    description: `${stalledProjects.length} program belum menunjukkan progress fisik`,
                    meta: 'Action needed'
                });
            }

            // Budget vs absorption gap (using smart getter)
            const bigGapItems = progressData.filter(item => {
                const budget = getPaguAnggaran(item); // Using smart getter
                const absorption = parseFloat(item.progressKeuangan) || 0;
                const gap = budget - absorption;
                return gap > 500000000; // 500 Juta gap
            });

            if (bigGapItems.length > 0) {
                issues.push({
                    type: 'info',
                    title: 'Gap Anggaran Signifikan',
                    description: `${bigGapItems.length} program memiliki selisih anggaran >Rp 500 Juta`,
                    meta: 'Monitor closely'
                });
            }

            if (issues.length === 0) {
                issues.push({
                    type: 'success',
                    title: 'Semua Program Normal',
                    description: 'Tidak ada issue kritikal yang terdeteksi',
                    meta: 'Good performance'
                });
            }

            container.innerHTML = issues.map(issue => `
                <div class="alert-item">
                    <div class="alert-icon" style="background: ${getIssueColor(issue.type)};">
                        <i class="fas ${getIssueIcon(issue.type)}"></i>
                    </div>
                    <div class="alert-content">
                        <h4>${issue.title}</h4>
                        <p>${issue.description}</p>
                        <div class="alert-meta">${issue.meta}</div>
                    </div>
                </div>
            `).join('');
        }
        END DISABLED generateCriticalIssues function */

        /* DISABLED - generateTopPerformers function (UI section removed)
        function generateTopPerformers() {
            const container = document.getElementById('topPerformers');
            
            // 🎯 CONTRACT PERFORMANCE FOCUS - Only analyze contracted programs
            const satkerPerformance = {};
            const regionalPerformance = {};
            
            // Use contractPerformanceDetails from calculateMetrics
            if (typeof window.contractPerformanceDetails === 'undefined' || window.contractPerformanceDetails.length === 0) {
                container.innerHTML = `
                    <div class="insight-item">
                        <div class="insight-header">
                            <div class="insight-icon info">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div>
                                <h4>Belum Ada Data Kontrak</h4>
                                <p>Tidak ada kontrak yang sedang berjalan untuk dianalisis</p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            // 🎯 ANALYZE ONLY CONTRACTED PROGRAMS FOR PERFORMANCE
            window.contractPerformanceDetails.forEach(contract => {
                const satkerName = contract.satker || 'Unknown Satker';
                const satkerKey = satkerName.replace(/\s+/g, '_');
                
                // SATKER CONTRACT PERFORMANCE TRACKING
                if (!satkerPerformance[satkerKey]) {
                    satkerPerformance[satkerKey] = {
                        name: satkerName,
                        contractedPrograms: 0,
                        totalKontrak: 0,
                        totalRealisasi: 0,
                        avgPhysicalProgress: 0,
                        avgFinancialEfficiency: 0,
                        totalPerformanceScore: 0,
                        riskLevel: 'LOW'
                    };
                }
                
                const perf = satkerPerformance[satkerKey];
                
                // Update contract performance metrics
                perf.contractedPrograms++;
                perf.totalKontrak += contract.nilaiKontrak;
                perf.totalRealisasi += contract.realisasi;
                perf.avgPhysicalProgress += contract.physicalProgress;
                perf.avgFinancialEfficiency += contract.financialEfficiency;
                perf.totalPerformanceScore += contract.performanceScore;
            });

            // 📈 CALCULATE CONTRACT PERFORMANCE SCORES
            Object.values(satkerPerformance).forEach(perf => {
                // Calculate averages for contracted programs only
                perf.avgPhysicalProgress = perf.contractedPrograms > 0 ? perf.avgPhysicalProgress / perf.contractedPrograms : 0;
                perf.avgFinancialEfficiency = perf.contractedPrograms > 0 ? perf.avgFinancialEfficiency / perf.contractedPrograms : 0;
                perf.avgPerformanceScore = perf.contractedPrograms > 0 ? perf.totalPerformanceScore / perf.contractedPrograms : 0;
                perf.absorptionRate = perf.totalKontrak > 0 ? (perf.totalRealisasi / perf.totalKontrak) * 100 : 0;
                
                // Risk assessment based on contract performance
                if (perf.avgPerformanceScore >= 70 && perf.absorptionRate >= 60) {
                    perf.riskLevel = 'LOW';
                } else if (perf.avgPerformanceScore >= 50 || perf.absorptionRate >= 40) {
                    perf.riskLevel = 'MEDIUM';
                } else {
                    perf.riskLevel = 'HIGH';
                }
                
                // Contract performance logging
                console.log(`📊 ${perf.name}: Score=${perf.avgPerformanceScore.toFixed(1)}, Physical=${perf.avgPhysicalProgress.toFixed(1)}%, Financial=${perf.avgFinancialEfficiency.toFixed(1)}%, Risk=${perf.riskLevel}`);
                if (perf.contractRate < 25 || perf.absorptionRate < 25) {
                    perf.riskLevel = 'HIGH';
                } else if (perf.contractRate < 50 || perf.absorptionRate < 50) {
                    perf.riskLevel = 'MEDIUM';
                } else {
                    perf.riskLevel = 'LOW';
                }
            });

            // 🏆 TOP CONTRACT PERFORMERS & RISK ANALYSIS
            const topContractPerformers = Object.values(satkerPerformance)
                .filter(perf => perf.contractedPrograms > 0) // Only those with contracts
                .sort((a, b) => b.avgPerformanceScore - a.avgPerformanceScore)
                .slice(0, 5);

            const highRiskContracts = Object.values(satkerPerformance)
                .filter(perf => perf.riskLevel === 'HIGH' && perf.contractedPrograms > 0)
                .sort((a, b) => a.avgPerformanceScore - b.avgPerformanceScore)
                .slice(0, 3);

            if (topContractPerformers.length === 0) {
                container.innerHTML = '<div class="loading">No contract performance data available</div>';
                return;
            }

            let performanceHTML = `<div style="margin-bottom: 20px;">`;
            
            // TOP CONTRACT PERFORMERS SECTION
            performanceHTML += `<h4 style="color: var(--success); margin-bottom: 12px;">
                🏆 Top Contract Performers (Untuk Apresiasi)
            </h4>`;
            
            performanceHTML += topContractPerformers.map((performer, index) => {
                const riskColor = performer.riskLevel === 'HIGH' ? 'var(--danger)' : 
                                 performer.riskLevel === 'MEDIUM' ? 'var(--warning)' : 'var(--success)';
                                 
                return `
                    <div class="alert-item" style="border-left: 3px solid ${riskColor};">
                    <div class="alert-icon" style="background: ${getPerformanceColor(index)};">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="alert-content">
                        <h4>#${index + 1} ${performer.name}</h4>
                            <p style="font-size: 0.85rem; margin: 4px 0;">
                                🏆 Performance Score: ${performer.avgPerformanceScore.toFixed(1)}/100 | 
                                📄 ${performer.contractedPrograms} kontrak aktif
                            </p>
                            <div class="alert-meta" style="font-size: 0.75rem;">
                                🏗️ Progress Fisik: ${performer.avgPhysicalProgress.toFixed(1)}% | 
                                💰 Efisiensi Keuangan: ${performer.avgFinancialEfficiency.toFixed(1)}% | 
                                🚨 Risk: ${performer.riskLevel}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // HIGH RISK CONTRACTS SECTION (for executive attention)
            if (highRiskContracts.length > 0) {
                performanceHTML += `<h4 style="color: var(--danger); margin: 20px 0 12px 0;">
                    🚨 Kontrak Berisiko Tinggi (Perlu Intervensi)
                </h4>`;
                
                performanceHTML += highRiskContracts.map(performer => `
                    <div class="alert-item" style="border-left: 3px solid var(--danger); background: rgba(239, 68, 68, 0.05);">
                        <div class="alert-icon" style="background: var(--danger);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <h4 style="color: var(--danger);">${performer.name}</h4>
                            <p style="font-size: 0.85rem; margin: 4px 0;">
                                🔴 Performance Score: ${performer.avgPerformanceScore.toFixed(1)}/100 | 
                                📄 ${performer.contractedPrograms} kontrak bermasalah
                            </p>
                            <div class="alert-meta" style="font-size: 0.75rem; color: var(--danger);">
                                🏗️ Progress Fisik: ${performer.avgPhysicalProgress.toFixed(1)}% | 
                                💰 Efisiensi Keuangan: ${performer.avgFinancialEfficiency.toFixed(1)}% | 
                                ⚠️ Butuh intervensi segera
                            </div>
                    </div>
                </div>
            `).join('');
        }
            
            performanceHTML += `</div>`;
            
            // REGIONAL SUMMARY FOR EXECUTIVES
            const topRegions = Object.entries(regionalPerformance)
                .sort(([,a], [,b]) => b.totalBudget - a.totalBudget)
                .slice(0, 5);
                
            if (topRegions.length > 0) {
                performanceHTML += `<h4 style="color: var(--info); margin: 20px 0 12px 0;">
                    🗺️ Regional Overview (Top 5 by Budget)
                </h4>`;
                
                performanceHTML += topRegions.map(([region, data]) => `
                    <div style="padding: 8px 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 6px; margin: 6px 0; background: rgba(59, 130, 246, 0.05);">
                        <div style="font-weight: 600; font-size: 0.9rem; margin-bottom: 4px;">
                            🗺️ ${region}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">
                            ${data.satkerCount} satker | ${data.totalPrograms} program | 
                            Kontrak: ${data.contractRate.toFixed(0)}% | 
                            Penyerapan: ${data.absorptionRate.toFixed(1)}% | 
                            Budget: ${formatCurrency(data.totalBudget)}
                        </div>
                    </div>
                `).join('');
            }
            
            container.innerHTML = performanceHTML;
            
            // 📈 EXECUTIVE LOGGING
            console.log('🏆 EXECUTIVE PERFORMANCE ANALYSIS:');
            console.log('Top Contract Performers:', topContractPerformers.map(p => `${p.name} (${p.avgPerformanceScore.toFixed(1)})`));
            console.log('High Risk Contracts:', highRiskContracts.map(p => `${p.name} (${p.riskLevel})`));
            console.log('Regional Performance:', Object.entries(regionalPerformance).map(([region, data]) => 
                `${region}: ${data.contractRate.toFixed(0)}% contract, ${data.absorptionRate.toFixed(1)}% absorption`
            ));
        }
        END DISABLED generateTopPerformers function */

        // Utility functions
        // 📋 GENERATE EXECUTIVE SUMMARY FOR LEADERSHIP
        function generateExecutiveSummary(data) {
            const {
                totalPrograms, contractedPrograms, contractRate, budgetUtilization,
                avgAbsorptionRate, totalBudget, totalKontrak, totalAbsorption,
                uniqueSatkerCount, performanceStatus, calculationMethod
            } = data;
            
            let summary = '';
            let recommendations = [];
            let alerts = [];
            
            // 🎯 PROGRAM STATUS ANALYSIS
            if (contractRate >= 80) {
                summary += `✅ <strong>Status Program:</strong> Mayoritas program (${contractedPrograms}/${totalPrograms}) telah memiliki kontrak. `;
            } else if (contractRate >= 50) {
                summary += `🟡 <strong>Status Program:</strong> ${contractedPrograms} dari ${totalPrograms} program telah berkontrak (${contractRate.toFixed(0)}%). `;
                recommendations.push('Percepat proses kontrak untuk program yang belum terkontrak');
            } else if (contractRate > 0) {
                summary += `🟠 <strong>Status Program:</strong> Hanya ${contractedPrograms} dari ${totalPrograms} program yang telah berkontrak. `;
                alerts.push('Mayoritas program belum memiliki kontrak');
                recommendations.push('Prioritas tinggi: Percepat proses tender dan kontrak');
            } else {
                summary += `🔴 <strong>Status Program:</strong> Belum ada program yang memiliki kontrak dari ${totalPrograms} program. `;
                alerts.push('URGENT: Tidak ada program yang terkontrak');
                recommendations.push('Tindakan segera diperlukan untuk proses kontrak');
            }
            
            // 💰 FINANCIAL PERFORMANCE ANALYSIS
            if (avgAbsorptionRate >= 75) {
                summary += `✅ <strong>Kinerja Keuangan:</strong> Penyerapan anggaran sangat baik (${avgAbsorptionRate.toFixed(1)}%). `;
            } else if (avgAbsorptionRate >= 50) {
                summary += `🟡 <strong>Kinerja Keuangan:</strong> Penyerapan anggaran cukup baik (${avgAbsorptionRate.toFixed(1)}%). `;
                recommendations.push('Tingkatkan percepatan realisasi anggaran');
            } else if (avgAbsorptionRate >= 25) {
                summary += `🟠 <strong>Kinerja Keuangan:</strong> Penyerapan anggaran perlu ditingkatkan (${avgAbsorptionRate.toFixed(1)}%). `;
                alerts.push('Penyerapan anggaran di bawah target');
                recommendations.push('Evaluasi hambatan realisasi anggaran');
            } else {
                summary += `🔴 <strong>Kinerja Keuangan:</strong> Penyerapan anggaran sangat rendah (${avgAbsorptionRate.toFixed(1)}%). `;
                alerts.push('CRITICAL: Penyerapan anggaran sangat rendah');
                recommendations.push('Tindakan darurat untuk percepatan realisasi');
            }
            
            // 🏢 ORGANIZATIONAL COVERAGE
            const avgProgramPerSatker = totalPrograms / uniqueSatkerCount;
            summary += `<strong>Cakupan Organisasi:</strong> ${uniqueSatkerCount} satuan kerja dengan rata-rata ${avgProgramPerSatker.toFixed(1)} program per satker. `;
            
            // 📈 METHOD TRANSPARENCY
            if (calculationMethod === 'from_contract') {
                summary += `<em>Data dihitung berdasarkan nilai kontrak aktual.</em>`;
            } else if (calculationMethod === 'from_budget_fallback') {
                summary += `<em>Data dihitung berdasarkan pagu anggaran (belum ada kontrak).</em>`;
                alerts.push('Perhitungan berdasarkan estimasi, bukan data aktual');
            }
            
            // 🚨 BUILD FINAL SUMMARY
            let finalSummary = `<div style="margin-bottom: 12px;">${summary}</div>`;
            
            if (alerts.length > 0) {
                finalSummary += `<div style="color: var(--danger); font-size: 0.75rem; margin: 8px 0;">`;
                finalSummary += `<strong>🚨 Perhatian:</strong> ${alerts.join('; ')}`;
                finalSummary += `</div>`;
            }
            
            if (recommendations.length > 0) {
                finalSummary += `<div style="color: var(--info); font-size: 0.75rem; margin: 8px 0;">`;
                finalSummary += `<strong>💡 Rekomendasi:</strong> ${recommendations.join('; ')}`;
                finalSummary += `</div>`;
            }
            
            // Financial summary for executives
            finalSummary += `<div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(0,0,0,0.1);">`;
            finalSummary += `💰 Anggaran: ${formatCurrency(totalBudget)} | Kontrak: ${formatCurrency(totalKontrak)} | Realisasi: ${formatCurrency(totalAbsorption)}`;
            finalSummary += `</div>`;
            
            document.getElementById('executiveSummaryContent').innerHTML = finalSummary;
            
            console.log('📋 EXECUTIVE SUMMARY GENERATED');
            console.log('Alerts:', alerts);
            console.log('Recommendations:', recommendations);
                }

        function calculateCoverageAnalysis() {
            console.log('📊 Starting Coverage Analysis... (FIXED VERSION)');
            
            // Debug: Check if progressData is available
            if (!progressData || progressData.length === 0) {
                console.warn('⚠️ progressData not available in calculateCoverageAnalysis');
                return;
            }
            
            // Basic data - recalculate to avoid scope issues
            const totalPrograms = progressData.length;
            console.log(`🔍 Total programs: ${totalPrograms}`);
            
            const kegiatanSudahKontrak = progressData.filter(item => {
                const nilaiKontrak = parseFloat(item.nilaiKontrak) || 0;
                return nilaiKontrak > 0;
            });
            console.log(`🔍 Contracted programs: ${kegiatanSudahKontrak.length}`);
            const contractedPrograms = kegiatanSudahKontrak.length;
            const uncontractedPrograms = totalPrograms - contractedPrograms;
            
            // Calculate totals
            const totalBudget = progressData.reduce((sum, item) => sum + getPaguAnggaran(item), 0);
            const totalKontrak = kegiatanSudahKontrak.reduce((sum, item) => sum + (parseFloat(item.nilaiKontrak) || 0), 0);
            const gapAmount = totalBudget - totalKontrak;
            
            // Coverage percentages
            const programCoverage = totalPrograms > 0 ? (contractedPrograms / totalPrograms) * 100 : 0;
            const budgetCoverage = totalBudget > 0 ? (totalKontrak / totalBudget) * 100 : 0;
            
            // Risk assessment
            let riskLevel = 'AMAN';
            let riskColor = 'var(--success)';
            let riskDescription = 'Coverage memadai';
            
            if (programCoverage < 60 || budgetCoverage < 60) {
                riskLevel = 'BERBAHAYA';
                riskColor = 'var(--danger)';
                riskDescription = 'Coverage rendah, perlu tindakan segera';
            } else if (programCoverage < 80 || budgetCoverage < 80) {
                riskLevel = 'PERHATIAN';
                riskColor = 'var(--warning)';
                riskDescription = 'Coverage perlu ditingkatkan';
            }
            
            // Urgency assessment
            let urgencyLevel = 'RENDAH';
            if (uncontractedPrograms > totalPrograms * 0.4) {
                urgencyLevel = 'TINGGI';
            } else if (uncontractedPrograms > totalPrograms * 0.2) {
                urgencyLevel = 'SEDANG';
            }
            
            // Update UI elements
            const updateCoverageElement = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                } else {
                    console.warn(`⚠️ Coverage element not found: ${id}`);
                }
            };
            
            const updateCoverageHTML = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = value;
                } else {
                    console.warn(`⚠️ Coverage element not found: ${id}`);
                }
            };
            
            // Program Coverage
            updateCoverageElement('programCoverage', programCoverage.toFixed(1) + '%');
            updateCoverageElement('contractedProgramsCount', contractedPrograms);
            updateCoverageElement('totalProgramsCount', totalPrograms);
            
            // Budget Coverage
            updateCoverageElement('budgetCoverage', budgetCoverage.toFixed(1) + '%');
            updateCoverageElement('contractedBudgetAmount', formatCurrency(totalKontrak));
            updateCoverageElement('totalBudgetAmount', formatCurrency(totalBudget));
            
            // Risk Level
            updateCoverageElement('riskLevel', riskLevel);
            updateCoverageElement('riskDescription', riskDescription);
            
            // Gap Analysis
            updateCoverageElement('gapCount', uncontractedPrograms);
            updateCoverageElement('gapAmount', formatCurrency(gapAmount));
            updateCoverageElement('urgencyLevel', `Urgency: ${urgencyLevel}`);
            
            // Update progress bars
            const programBar = document.getElementById('programCoverageBar');
            const budgetBar = document.getElementById('budgetCoverageBar');
            const riskIndicator = document.getElementById('riskIndicator');
            
            if (programBar) {
                programBar.style.width = programCoverage.toFixed(1) + '%';
                programBar.style.background = programCoverage >= 80 ? 'var(--success)' : 
                                            programCoverage >= 60 ? 'var(--warning)' : 'var(--danger)';
            }
            
            if (budgetBar) {
                budgetBar.style.width = budgetCoverage.toFixed(1) + '%';
                budgetBar.style.background = budgetCoverage >= 80 ? 'var(--success)' : 
                                           budgetCoverage >= 60 ? 'var(--warning)' : 'var(--danger)';
            }
            
            if (riskIndicator) {
                riskIndicator.style.background = riskColor;
            }
            
            // Console logging for debugging
            console.log('📊 COVERAGE ANALYSIS RESULTS:');
            console.log(`📋 Program Coverage: ${contractedPrograms}/${totalPrograms} (${programCoverage.toFixed(1)}%)`);
            console.log(`💰 Budget Coverage: ${formatCurrency(totalKontrak)}/${formatCurrency(totalBudget)} (${budgetCoverage.toFixed(1)}%)`);
            console.log(`🚨 Risk Level: ${riskLevel} - ${riskDescription}`);
            console.log(`⚠️ Gap: ${uncontractedPrograms} programs, ${formatCurrency(gapAmount)} - Urgency: ${urgencyLevel}`);
        }

        function getUniqueSatkerCount() {
            const uniqueSatkers = new Set(progressData.map(item => item.satkerCode));
            return uniqueSatkers.size;
        }

        function getIssueColor(type) {
            switch(type) {
                case 'critical': return '#FF3B30';
                case 'warning': return '#FF9500';
                case 'info': return '#007AFF';
                case 'success': return '#34C759';
                default: return '#8E8E93';
            }
        }

        function getIssueIcon(type) {
            switch(type) {
                case 'critical': return 'fa-exclamation-triangle';
                case 'warning': return 'fa-exclamation-circle';
                case 'info': return 'fa-info-circle';
                case 'success': return 'fa-check-circle';
                default: return 'fa-circle';
            }
        }

        function getPerformanceColor(index) {
            const colors = ['#FFD700', '#C0C0C0', '#CD7F32', '#007AFF', '#5AC8FA'];
            return colors[index] || '#8E8E93';
        }

        function formatCurrency(amount) {
            // Handle very large numbers with better formatting
            if (amount >= 1000000000000) { // Triliun
                return `Rp ${(amount / 1000000000000).toFixed(1)} Triliun`;
            } else if (amount >= 1000000000) { // Milyar
                return `Rp ${(amount / 1000000000).toFixed(1)} Milyar`;
            } else if (amount >= 1000000) { // Juta
                return `Rp ${(amount / 1000000).toFixed(1)} Juta`;
            } else {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            }
        }

        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Last Updated: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID')}`;
        }

        function showDataAssignmentWarning() {
            // Add warning message to dashboard
            const existingWarning = document.querySelector('.data-assignment-warning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            const warningDiv = document.createElement('div');
            warningDiv.className = 'data-assignment-warning';
            warningDiv.style.cssText = `
                background: #FFF3CD;
                border: 2px solid #FF9500;
                border-radius: 12px;
                padding: 20px;
                margin: 20px;
                color: #856404;
                text-align: center;
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                max-width: 600px;
            `;
            
            warningDiv.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 16px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 24px; color: #FF9500;"></i>
                    <div style="flex: 1;">
                        <strong style="display: block; margin-bottom: 8px;">🚨 Data Regional Assignment Diperlukan</strong>
                        <span>Data tidak muncul karena semua data memiliki satkerCode "ALL". Perlu assignment ke regional satker.</span>
                    </div>
                    <button onclick="openRegionalFixTool()" style="background: #FF9500; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        🔧 Fix Sekarang
                    </button>
                </div>
            `;
            
            document.body.appendChild(warningDiv);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (warningDiv.parentNode) {
                    warningDiv.parentNode.removeChild(warningDiv);
                }
            }, 10000);
        }

        function openRegionalFixTool() {
            window.open('fix-all-regions-simple.html', '_blank');
            console.log('🔧 Regional fix tool opened');
        }

        function showEmptyState() {
            document.getElementById('totalBudget').textContent = 'Rp 0';
            document.getElementById('totalAbsorption').textContent = 'Rp 0';
            document.getElementById('avgAbsorptionRate').textContent = '0%';
            document.getElementById('totalPrograms').textContent = '0';
            document.getElementById('totalSatker').textContent = 'Total Satker: 0';
        }

        function showFallbackMessage() {
            const containers = ['criticalIssues', 'topPerformers'];
            containers.forEach(containerId => {
                document.getElementById(containerId).innerHTML = 
                    '<div class="loading">Unable to load data. Please try refreshing the page.</div>';
            });
        }

        // Sample data generator removed - using real Firebase data only
        // If you need to re-enable sample data for testing, uncomment the function above

        // Action functions
        function refreshDashboard() {
            console.log('🔄 Refreshing dashboard...');
            location.reload();
        }

        function exportReport() {
            console.log('📄 Exporting report...');
            
            // Create export data
            const exportData = {
                generatedAt: new Date().toISOString(),
                summary: {
                    totalPrograms: progressData.length,
                    totalBudget: progressData.reduce((sum, item) => sum + (parseFloat(item.nilaiAnggaran) || 0), 0),
                    totalAbsorption: progressData.reduce((sum, item) => sum + (parseFloat(item.progressKeuangan) || 0), 0),
                    uniqueSatkers: getUniqueSatkerCount()
                },
                data: progressData
            };
            
            // Download as JSON
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `executive-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            console.log('✅ Report exported successfully');
        }
    </script>

    <!-- FOOTER SECTION - WORLD CLASS DESIGN -->
    <footer style="margin-top: 80px; border-top: 1px solid #e2e8f0; padding-top: 48px;">
        
        <!-- Dashboard Meta Information -->
        <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        ">
            <div style="
                background: #ffffff;
                padding: 20px 24px;
                border-radius: 12px;
                border: 1px solid #e2e8f0;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;
            ">
                <div style="
                    width: 40px;
                    height: 40px;
                    background: #3b82f6;
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                ">
                    <i class="fas fa-calendar-alt" style="color: white; font-size: 1.1rem;"></i>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #64748b; font-weight: 500; margin-bottom: 2px;">Last Updated</div>
                    <div id="lastUpdate" style="font-size: 0.9rem; color: #1a202c; font-weight: 600;">Loading...</div>
                </div>
            </div>

            <div style="
                background: #ffffff;
                padding: 20px 24px;
                border-radius: 12px;
                border: 1px solid #e2e8f0;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;
            ">
                <div style="
                    width: 40px;
                    height: 40px;
                    background: #10b981;
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                ">
                    <i class="fas fa-database" style="color: white; font-size: 1.1rem;"></i>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #64748b; font-weight: 500; margin-bottom: 2px;">Data Source</div>
                    <div id="dataSource" style="font-size: 0.9rem; color: #1a202c; font-weight: 600;">Loading...</div>
                </div>
            </div>

            <div style="
                background: #ffffff;
                padding: 20px 24px;
                border-radius: 12px;
                border: 1px solid #e2e8f0;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;
            ">
                <div style="
                    width: 40px;
                    height: 40px;
                    background: #f59e0b;
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                ">
                    <i class="fas fa-users" style="color: white; font-size: 1.1rem;"></i>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #64748b; font-weight: 500; margin-bottom: 2px;">Total Satker</div>
                    <div id="totalSatker" style="font-size: 0.9rem; color: #1a202c; font-weight: 600;">Loading...</div>
                </div>
            </div>

            <div style="
                background: #ffffff;
                padding: 20px 24px;
                border-radius: 12px;
                border: 1px solid #e2e8f0;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;
            ">
                <div style="
                    width: 40px;
                    height: 40px;
                    background: #6366f1;
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                ">
                    <i class="fas fa-check-circle" style="color: white; font-size: 1.1rem;"></i>
                </div>
                <div>
                    <div style="font-size: 0.8rem; color: #64748b; font-weight: 500; margin-bottom: 2px;">System Status</div>
                    <div id="dashboardStatus" style="font-size: 0.9rem; color: #1a202c; font-weight: 600;">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Executive Summary - Premium Design -->
        <div style="
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            max-width: 1200px;
            margin: 0 auto;
        ">
            <!-- Header with gradient -->
            <div style="
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
                padding: 24px 32px;
                text-align: center;
            ">
                <h3 style="
                    font-size: 1.75rem;
                    font-weight: 700;
                    color: white;
                    margin: 0 0 8px 0;
                    letter-spacing: -0.025em;
                ">📋 Executive Summary</h3>
                <p style="
                    color: rgba(255, 255, 255, 0.9);
                    margin: 0;
                    font-size: 1.1rem;
                    font-weight: 400;
                ">Ringkasan Strategis untuk Pimpinan</p>
            </div>
            
            <!-- Content area -->
            <div style="padding: 32px;">
                <div id="executiveSummary" style="
                    background: #ffffff;
                    padding: 32px;
                    border-radius: 16px;
                    border: 1px solid #e2e8f0;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                ">
                    <div id="executiveSummaryContent" style="
                        font-size: 1rem;
                        line-height: 1.7;
                        color: #374151;
                        text-align: left;
                    ">
                        <div style="
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 40px;
                            color: #9ca3af;
                        ">
                            <i class="fas fa-spinner fa-spin" style="margin-right: 12px;"></i>
                            Loading executive summary...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Copyright Footer -->
        <div style="
            text-align: center;
            margin-top: 48px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
            color: #64748b;
            font-size: 0.875rem;
        ">
            <p style="margin: 0;">
                © 2025 Inspektorat Jenderal Kementerian Transmigrasi Republik Indonesia
            </p>
            <p style="margin: 8px 0 0 0; font-size: 0.8rem; opacity: 0.8;">
                Sistem Monitoring dan Evaluasi Program Kontraktual
            </p>
        </div>
    </footer>

    </div> <!-- End dashboard-container -->
</body>
</html>
