<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC-More - Trans Continuous Monitoring & Reporting | Inspektorat Jenderal Kementerian Transmigrasi RI</title>
    
    <!-- Favicon dan Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="logo/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="logo/logo.png">
    <link rel="shortcut icon" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="144x144" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="120x120" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="114x114" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="76x76" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="72x72" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="60x60" href="logo/logo.png">
    <link rel="apple-touch-icon" sizes="57x57" href="logo/logo.png">
    
    <!-- Meta Tags untuk Social Media dan WhatsApp -->
    <meta name="description" content="TC-More - Trans Continuous Monitoring & Reporting oleh Inspektorat Jenderal Kementerian Transmigrasi RI. Dashboard profesional untuk monitoring progress kegiatan dan realisasi anggaran.">
    <meta name="keywords" content="TC-More, Trans Continuous Monitoring, Reporting, Inspektorat Jenderal, Kementerian Transmigrasi, Dashboard, Progress, Kegiatan">
    <meta name="author" content="Inspektorat Jenderal Kementerian Transmigrasi">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:title" content="TC-More - Trans Continuous Monitoring & Reporting">
    <meta property="og:description" content="Dashboard profesional untuk monitoring progress kegiatan dan realisasi anggaran Inspektorat Jenderal Kementerian Transmigrasi RI.">
    <meta property="og:image" content="logo/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="TC-More - Inspektorat Jenderal Kementerian Transmigrasi RI">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="TC-More - Trans Continuous Monitoring & Reporting">
    <meta property="twitter:description" content="Dashboard profesional untuk monitoring progress kegiatan dan realisasi anggaran Inspektorat Jenderal Kementerian Transmigrasi RI.">
    <meta property="twitter:image" content="logo/logo.png">
    
    <!-- WhatsApp Meta Tags -->
    <meta property="og:image:alt" content="Logo Inspektorat Jenderal Kementerian Transmigrasi">
    <meta name="thumbnail" content="logo/logo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Modern Header - Desktop Version */
        .modern-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #06b6d4 100%);
            color: white;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-logo {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .app-logo img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .header-title {
            font-size: 1.75rem;
            font-weight: 800;
            line-height: 1.1;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 500;
            line-height: 1.2;
        }

        .header-org {
            font-size: 0.8rem;
            opacity: 0.75;
            font-weight: 400;
            margin-top: 2px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-btn {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            font-weight: 500;
            text-decoration: none;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }

        /* User Info Compact in Header */
        .user-info-compact {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 12px;
        }

        .user-info-compact .user-info-icon {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .user-info-compact .user-info-content {
            flex: 1;
            min-width: 0;
        }

        .user-info-compact .user-role {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info-compact .user-satker {
            font-size: 0.7rem;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* User Info Card - Compact & Professional */
        .user-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin: 0 24px 16px 24px;
            padding: 12px 16px;
            border-radius: 12px;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
        }

        .user-info-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .user-info-content {
            flex: 1;
            min-width: 0;
        }

        .user-role {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-satker {
            font-size: 0.75rem;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Quick Actions */
        .quick-actions {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .quick-action {
            background: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            text-decoration: none;
            color: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s;
            border: 1px solid #f1f5f9;
        }

        .quick-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .quick-action-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px auto;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .quick-action.executive .quick-action-icon {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .quick-action.add .quick-action-icon {
            background: linear-gradient(135deg, #10b981, #059669);
        }


        .quick-action-label {
            font-size: 0.9rem;
            font-weight: 500;
            line-height: 1.2;
        }

        /* Stats Section */
        .stats-section {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px 24px 24px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
            transition: all 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        /* Filter Section */
        .filter-section {
            background: white;
            margin: 0 auto 32px auto;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            max-width: 1400px;
            width: calc(100% - 80px);
            box-sizing: border-box;
            overflow: hidden;
        }

        .filter-header {
            padding: 24px 24px 20px 24px;
            border-bottom: 2px solid #e5e7eb;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 20px 20px 0 0;
        }

        .filter-title {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .filter-title h2 {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e293b;
            margin: 0;
            line-height: 1.2;
        }

        /* Data Section */
        .data-section {
            background: white;
            margin: 0 auto 32px auto;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            min-height: 60vh;
            position: relative;
            max-width: 1400px;
            width: calc(100% - 80px);
            box-sizing: border-box;
            overflow: hidden;
        }

        /* Filters Container */
        .filters-container {
            margin-bottom: 20px;
        }

        .search-container {
            position: relative;
            margin-bottom: 24px;
        }

        .search-container .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 18px;
            z-index: 2;
        }

        .search-container input {
            width: 100%;
            padding: 16px 20px 16px 52px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            font-weight: 500;
        }

        .search-container input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 8px 24px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
            background: white;
        }

        .search-container input:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 32px 40px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            backdrop-filter: blur(10px);
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 0;
            width: 100%;
        }

        .filter-group label {
            font-size: 0.875rem;
            font-weight: 700;
            color: #374151;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            line-height: 1.4;
        }

        .filter-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-1px);
        }

        .filter-group select:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        /* Message Container */
        #messageContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
        }

        .message {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideInRight 0.3s ease-out;
        }

        .message.success {
            background: #10b981;
            color: white;
        }

        .message.error {
            background: #ef4444;
            color: white;
        }

        .message.warning {
            background: #f59e0b;
            color: white;
        }

        .message.info {
            background: #3b82f6;
            color: white;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* View Modal Styles */
        .view-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .view-modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .view-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .view-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            line-height: 1.3;
        }

        .view-modal-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 8px 0 0 0;
        }

        .view-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .view-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .view-modal-body {
            padding: 32px;
        }

        .view-section {
            margin-bottom: 32px;
            padding: 24px;
            background: #f8fafc;
            border-radius: 16px;
            border-left: 4px solid #667eea;
        }

        .view-section:last-child {
            margin-bottom: 0;
        }

        .view-section h5 {
            margin: 0 0 20px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-section h5 i {
            color: #667eea;
            font-size: 1rem;
        }

        .view-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .view-info-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .view-info-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .view-info-value {
            font-size: 1rem;
            font-weight: 500;
            color: #1e293b;
            word-break: break-word;
        }

        .view-progress-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 8px 0;
        }

        .view-progress-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .view-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .view-progress-text {
            font-weight: 600;
            color: #1e293b;
            min-width: 50px;
            text-align: right;
        }

        .view-status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-belum-mulai {
            background: #fef3c7;
            color: #92400e;
        }

        .status-tahap-awal {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-berjalan {
            background: #d1fae5;
            color: #065f46;
        }

        .status-hampir-selesai {
            background: #fde68a;
            color: #b45309;
        }

        .status-selesai {
            background: #dcfce7;
            color: #166534;
        }

        /* Responsive View Modal */
        @media (max-width: 768px) {
            .view-modal-content {
                width: 95%;
                margin: 5% auto;
                max-height: 85vh;
            }

            .view-modal-header {
                padding: 20px;
            }

            .view-modal-title {
                font-size: 1.3rem;
            }

            .view-modal-body {
                padding: 24px;
            }

            .view-section {
                padding: 20px;
                margin-bottom: 24px;
            }

            .view-info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        .data-header {
            padding: 24px 24px 20px 24px;
            border-bottom: 1px solid #f1f5f9;
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            border-radius: 20px 20px 0 0;
        }

        .data-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .data-title h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
        }

        .data-count {
            background: #f1f5f9;
            color: #64748b;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .modern-search {
            position: relative;
            margin-bottom: 16px;
        }

        .modern-search input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.9rem;
            background: #f8fafc;
            transition: all 0.2s;
        }

        .modern-search input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .modern-search .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        /* Filter Pills */
        .filter-pills {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            overflow-x: auto;
            padding: 16px 20px;
            -webkit-overflow-scrolling: touch;
        }

        .filter-pills::-webkit-scrollbar {
            display: none;
        }

        .filter-pill {
            background: #f1f5f9;
            color: #64748b;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }

        .filter-pill.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .filter-pill:hover {
            background: #e2e8f0;
        }

        .filter-pill.active:hover {
            background: #2563eb;
        }

        /* Data List */
        .data-list {
            padding: 0 24px 24px 24px;
        }

        .data-item {
            background: white;
            border: 1px solid #f1f5f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.2s;
        }

        .data-item:hover {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }

        .data-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .data-item-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.3;
            flex: 1;
            margin-right: 16px;
        }

        .data-item-number {
            background: #f1f5f9;
            color: #64748b;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 32px;
            text-align: center;
        }

        .data-item-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #64748b;
        }

        .meta-icon {
            width: 16px;
            text-align: center;
            color: #94a3b8;
        }

        .data-item-amount {
            background: #f0fdf4;
            color: #166534;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 16px;
            font-family: 'Courier New', monospace;
        }

        .data-item-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        .action-btn.primary {
            background: #3b82f6;
            color: white;
        }

        .action-btn.primary:hover {
            background: #2563eb;
        }

        .action-btn.secondary {
            background: #f1f5f9;
            color: #64748b;
        }

        .action-btn.secondary:hover {
            background: #e2e8f0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: 16px 20px;
            }

            .header-title {
                font-size: 1.3rem;
            }

            .header-subtitle {
                font-size: 0.8rem;
            }

            .header-org {
                font-size: 0.7rem;
            }

            .header-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .user-info {
                margin: 0 20px 20px 20px;
                padding: 16px;
            }

            .quick-actions {
                padding: 20px;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .quick-action {
                padding: 16px 12px;
            }

            .quick-action-icon {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .quick-action-label {
                font-size: 0.8rem;
            }

            .stats-section {
                padding: 0 20px 20px 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 1.4rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }

            .filter-section {
                margin: 0 auto 24px auto;
                width: calc(100% - 40px);
            }

            .filter-header {
                padding: 20px;
            }

            .data-section {
                margin: 0 auto 24px auto;
                width: calc(100% - 40px);
                border-radius: 20px 20px 0 0;
            }

            .data-header {
                padding: 20px;
                gap: 16px;
            }

            .data-title h2 {
                font-size: 1.5rem;
            }

            .filter-row {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 12px;
            }

            .search-container input {
                padding: 14px 18px 14px 48px;
                font-size: 0.95rem;
            }

            .filter-group select {
                padding: 12px 14px;
                font-size: 0.9rem;
            }

            .data-list {
                padding: 0 20px 20px 20px;
            }

            .data-item {
                padding: 16px;
                margin-bottom: 12px;
            }

            .data-item-title {
                font-size: 0.9rem;
            }

            .data-item-meta {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .meta-item {
                font-size: 0.8rem;
            }

            .data-item-amount {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .action-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }

        /* Tablet Responsive */
        @media (max-width: 1024px) {
            .filter-section {
                margin: 0 auto 28px auto;
                width: calc(100% - 60px);
            }

            .data-section {
                margin: 0 auto 28px auto;
                width: calc(100% - 60px);
            }

            .filter-row {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                padding: 24px 32px;
            }
        }

        /* Small Tablet */
        @media (max-width: 600px) {
            .filter-row {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 20px 24px;
            }
            
            .data-header {
                padding: 16px;
            }
            
            .search-container input {
                padding: 12px 16px 12px 44px;
                font-size: 0.9rem;
            }
            
            .filter-group select {
                padding: 12px 14px;
                font-size: 0.9rem;
            }
            
            .filter-pills {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                padding: 12px 16px;
            }
        }

        /* Medium Mobile Responsive */
        @media (max-width: 640px) {
            .quick-actions {
                padding: 16px;
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .quick-action {
                padding: 18px 16px;
                display: flex;
                align-items: center;
                gap: 16px;
                text-align: left;
            }

            .quick-action-icon {
                width: 44px;
                height: 44px;
                margin: 0;
                flex-shrink: 0;
            }

            .quick-action-label {
                font-size: 0.85rem;
                font-weight: 600;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 12px 16px;
            }

            .header-left {
                gap: 12px;
            }

            .header-title {
                font-size: 1.2rem;
            }

            .header-subtitle {
                font-size: 0.75rem;
            }

            .header-org {
                font-size: 0.65rem;
            }

            .app-logo {
                width: 40px;
                height: 40px;
            }

            .app-logo img {
                width: 28px;
                height: 28px;
            }

            .header-right {
                gap: 8px;
            }

            .header-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .user-info {
                margin: 0 16px 16px 16px;
                padding: 12px;
            }

            .quick-actions {
                padding: 16px;
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .quick-action {
                padding: 20px 16px;
                display: flex;
                align-items: center;
                gap: 16px;
                text-align: left;
            }

            .quick-action-icon {
                width: 48px;
                height: 48px;
                margin: 0;
                flex-shrink: 0;
            }

            .quick-action-label {
                font-size: 0.9rem;
                font-weight: 600;
            }

            .stats-section {
                padding: 0 16px 16px 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .filter-section {
                margin: 0 auto 16px auto;
                width: calc(100% - 32px);
            }

            .filter-header {
                padding: 16px;
            }

            .data-section {
                margin: 0 auto 16px auto;
                width: calc(100% - 32px);
            }

            .data-header {
                padding: 16px;
                gap: 12px;
            }

            .data-title h2 {
                font-size: 1.25rem;
            }

            .filter-row {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 16px 20px;
            }

            .search-container input {
                padding: 12px 16px 12px 44px;
                font-size: 0.9rem;
            }

            .filter-group select {
                padding: 10px 12px;
                font-size: 0.85rem;
            }
            
            .filter-pills {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
                padding: 10px 14px;
            }
            
            .filter-pill {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .data-list {
                padding: 0 16px 16px 16px;
            }
        }

        .navbar-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: #1e293b;
        }

        .navbar-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .navbar-title {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn-outline {
            background: transparent;
            color: #3b82f6;
            border: 2px solid #3b82f6;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-outline:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-1px);
        }

        .btn-outline.success {
            color: #10b981;
            border-color: #10b981;
        }

        .btn-outline.success:hover {
            background: #10b981;
            color: white;
        }

        .btn-outline.danger {
            color: #ef4444;
            border-color: #ef4444;
        }

        .btn-outline.danger:hover {
            background: #ef4444;
            color: white;
        }

        .navbar .user-info {
            text-align: right;
        }

        .navbar .user-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }

        .user-satker {
            color: #6b7280;
            font-size: 0.8rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        /* Filters */
        .filters {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.10);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .filters h3 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 0;
            width: 100%;
        }

        .filter-group label {
            color: #6b7280;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .filter-group input,
        .filter-group select {
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Data Container */
        .data-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.10);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .data-header {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 24px;
            padding: 24px;
            border-bottom: 2px solid #e5e7eb;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 16px 16px 0 0;
        }

        .data-title {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .data-title h2 {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e293b;
            margin: 0;
            line-height: 1.2;
        }

        .data-count {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            align-self: flex-start;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .data-actions {
            display: flex;
            gap: 12px;
        }

        .btn-info {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.12);
        }

        .btn-info:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.10);
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #1e40af;
            font-size: 1.875rem;
            font-weight: 700;
        }

        /* REMOVED DUPLICATE .user-info CSS - ONLY USE NAVBAR VERSION */

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
        }

        .stat-card h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
        }
        
        .stat-card .breakdown {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e5e7eb;
        }
        
        .stat-card .breakdown small {
            color: #6b7280;
            font-size: 0.75rem;
            line-height: 1.4;
        }
        
        .stat-card .method-indicator {
            margin-top: 4px;
        }
        
        .stat-card .method-indicator small {
            color: #6b7280;
            font-size: 0.75rem;
            font-style: italic;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #6b7280; color: white; }

        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* Dropdown Styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 12px 16px;
            background: none;
            border: none;
            text-align: left;
            color: #374151;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .dropdown-item:hover {
            background-color: #f3f4f6;
            transform: none;
            box-shadow: none;
        }

        .dropdown-item:first-child {
            border-radius: 8px 8px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 8px 8px;
        }

        .dropdown-item i {
            width: 16px;
            color: #6b7280;
        }

        /* View Modal Styles */
        .view-content {
            max-height: 70vh;
            overflow-y: auto;
            padding: 0;
        }

        .view-section {
            margin-bottom: 24px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }

        .view-section h5 {
            margin: 0 0 16px 0;
            color: #1e293b;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .view-header h4 {
            margin: 0;
            color: #1e293b;
            font-size: 1.25rem;
            font-weight: 600;
            flex: 1;
        }

        .view-badges {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            background: #10b981;
            color: white;
        }

        .badge.secondary {
            background: #6b7280;
        }

        .view-subtitle {
            margin: 0;
            color: #6b7280;
            font-size: 0.95rem;
            font-style: italic;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .progress-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .progress-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .info-item {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-value {
            font-size: 1rem;
            color: #1e293b;
            font-weight: 600;
        }

        .view-text-item {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 12px;
        }

        .info-text {
            font-size: 0.95rem;
            color: #374151;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        /* Responsive adjustments for view modal */
        @media (max-width: 768px) {
            .progress-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .view-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .view-badges {
                align-self: stretch;
            }
        }

        .search-box {
            flex: 1;
            max-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }

        tr:hover {
            background: #f8fafc;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #10b981;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .action-btn.edit { background: #f59e0b; color: white; }
        .action-btn.delete { background: #ef4444; color: white; }
        .action-btn.view { background: #10b981; color: white; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 10px;
            right: 15px;
            z-index: 1001;
        }

        .close:hover {
            color: #374151;
            background: #f3f4f6;
            border-radius: 50%;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .message {
            padding: 12px 20px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .message.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #d1d5db;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header { flex-direction: column; gap: 15px; }
            .controls { flex-direction: column; align-items: stretch; }
            .search-box { max-width: none; }
            .stats-grid { grid-template-columns: 1fr; }
            .modal-content { width: 95%; padding: 20px; margin: 20px; }
        }

        /* Link Preview */
        .link-preview {
            margin-top: var(--space-2);
            padding: var(--space-3);
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-light);
            display: none;
        }

        .link-preview.show {
            display: block;
        }

        .link-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: var(--radius-sm);
            object-fit: cover;
        }

        .link-preview-text {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: var(--space-2);
        }

        /* View Documentation Styles */
        .view-documentation-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
        }

        .view-documentation-content {
            margin-top: 0.5rem;
        }

        .view-doc-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-bottom: 0.5rem;
        }

        .view-doc-link:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .view-doc-preview {
            margin-top: 0.5rem;
        }

        .view-doc-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: var(--radius-sm);
            object-fit: cover;
            box-shadow: var(--shadow-md);
        }

        .view-doc-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            background: white;
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
            border: 1px solid var(--border-light);
        }

        .view-doc-item:last-child {
            margin-bottom: 0;
        }

        .view-doc-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-light);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .view-doc-info {
            flex: 1;
        }

        .view-doc-name {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .view-doc-url {
            font-size: 0.8rem;
            color: var(--text-secondary);
            word-break: break-all;
        }

        /* Footer dengan Branding TC-More */
        .footer {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 40px 24px 20px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1600px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-branding {
            margin-bottom: 24px;
        }

        .footer-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #3b82f6;
        }

        .footer-subtitle {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .footer-org {
            font-size: 0.9rem;
            opacity: 0.7;
            font-weight: 400;
        }

        .footer-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            margin: 24px 0 16px;
        }

        .footer-copyright {
            font-size: 0.85rem;
            opacity: 0.6;
        }

        /* Footer Responsive */
        @media (max-width: 768px) {
            .footer {
                padding: 32px 20px 16px;
            }

            .footer-title {
                font-size: 1.3rem;
            }

            .footer-subtitle {
                font-size: 0.9rem;
            }

            .footer-org {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .footer {
                padding: 24px 16px 12px;
            }

            .footer-title {
                font-size: 1.2rem;
            }

            .footer-subtitle {
                font-size: 0.85rem;
            }

            .footer-org {
                font-size: 0.75rem;
            }

            .footer-copyright {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Modern Header -->
    <div class="modern-header">
        <div class="header-content">
            <div class="header-left">
                <div class="app-logo">
                    <img src="logo/logo.png" alt="Logo">
                </div>
                <div>
                    <div class="header-title">TC-More</div>
                    <div class="header-subtitle">Trans Continuous Monitoring & Reporting</div>
                    <div class="header-org">Inspektorat Jenderal Kementerian Transmigrasi RI</div>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info-compact">
                    <div class="user-info-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="user-info-content">
                        <div class="user-role" id="userRole">Super Administrator</div>
                        <div class="user-satker" id="userSatker">All Satuan Kerja</div>
                    </div>
                </div>
                <button class="header-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <a href="executive-dashboard.html" class="quick-action executive">
            <div class="quick-action-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="quick-action-label">Executive Dashboard</div>
        </a>
        <a href="form-progress-kegiatan.html" class="quick-action add">
            <div class="quick-action-icon">
                <i class="fas fa-plus"></i>
            </div>
            <div class="quick-action-label">Tambah Data</div>
        </a>
    </div>

    <!-- Stats Section -->
    <div class="stats-section">
        <div class="section-title">
            <i class="fas fa-chart-bar"></i>
            Ringkasan Data
        </div>
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalData">0</div>
                <div class="stat-label">Total Kegiatan</div>
                </div>
            <div class="stat-card">
                <div class="stat-value" id="totalBudget">Rp 0</div>
                <div class="stat-label">Total Pagu</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgProgress">0%</div>
                <div class="stat-label">Rata-rata Progress</div>
                </div>
            <div class="stat-card">
                <div class="stat-value" id="completedData">0</div>
                <div class="stat-label">Selesai</div>
            </div>
            </div>
        </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header fade-in-up">
            <h1><i class="fas fa-chart-bar"></i> Dashboard Progress Kegiatan</h1>
            <p>Monitoring dan pelaporan progress fisik & keuangan kegiatan satuan kerja</p>
        </div>

        <!-- Statistics -->


        <!-- Messages -->
        <div id="messageContainer"></div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-header">
                <div class="filter-title">
                    <h2>Filter & Pencarian</h2>
                    <div class="data-count" id="dataCount">0 data</div>
                </div>
            </div>
            
            <!-- Search and Filters -->
            <div class="filters-container">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Cari kegiatan, lokasi, atau PIC..." onkeyup="filterData()">
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Satuan Kerja</label>
                        <select id="satkerFilter" onchange="filterData()">
                            <option value="">Semua Satker</option>
                        </select>
            </div>
                    
                    <div class="filter-group">
                        <label>Lokasi</label>
                        <select id="lokasiFilter" onchange="filterData()">
                            <option value="">Semua Lokasi</option>
                        </select>
        </div>

                <div class="filter-group">
                        <label>PIC Program</label>
                        <select id="picFilter" onchange="filterData()">
                            <option value="">Semua PIC</option>
                        </select>
                </div>

                <div class="filter-group">
                    <label>Progress Fisik</label>
                    <select id="progressFilter" onchange="filterData()">
                        <option value="">Semua Progress</option>
                        <option value="0">Belum Mulai (0%)</option>
                        <option value="1-25">Tahap Awal (1-25%)</option>
                        <option value="26-50">Tahap Menengah (26-50%)</option>
                        <option value="51-75">Tahap Lanjut (51-75%)</option>
                        <option value="76-99">Hampir Selesai (76-99%)</option>
                        <option value="100">Selesai (100%)</option>
                    </select>
                </div>
                </div>
                
                <div class="filter-pills" id="filterPills">
                    <div class="filter-pill active" data-filter="all">Semua</div>
                    <div class="filter-pill" data-filter="belum-mulai">Belum Mulai</div>
                    <div class="filter-pill" data-filter="berjalan">Berjalan</div>
                    <div class="filter-pill" data-filter="selesai">Selesai</div>
                </div>
            </div>
        </div>

        <!-- Data Section -->
        <div class="data-section">
            <div class="data-header">
                <div class="data-title">
                    <h2>Data Progress Kegiatan</h2>
                </div>
                        </div>
            
            <div class="data-list" id="dataList">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat data...</p>
                    </div>
            </div>
                </div>
            </div>

    <!-- View Modal -->
    <div id="viewModal" class="view-modal">
        <div class="view-modal-content">
            <div class="view-modal-header">
                <h2 class="view-modal-title" id="view_namaKegiatan">Nama Kegiatan</h2>
                <p class="view-modal-subtitle" id="view_namaPaket">Nama Paket</p>
                <button class="view-modal-close" onclick="closeViewModal()">&times;</button>
                </div>
            
            <div class="view-modal-body">
                <!-- Basic Information -->
                <div class="view-section">
                    <h5><i class="fas fa-info-circle"></i> Informasi Dasar</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Kode Kegiatan</div>
                            <div class="view-info-value" id="view_kodeKegiatan">-</div>
            </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Jenis Kegiatan</div>
                            <div class="view-info-value" id="view_jenisKegiatan">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Indikator</div>
                            <div class="view-info-value" id="view_indikator">-</div>
                    </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Target Output</div>
                            <div class="view-info-value" id="view_targetOutput">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Uraian Output</div>
                            <div class="view-info-value" id="view_uraianOutput">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Status</div>
                            <div class="view-info-value">
                                <span class="view-status-badge" id="view_statusBadge">-</span>
                            </div>
                        </div>
                </div>
            </div>

                <!-- Location Information -->
                <div class="view-section">
                    <h5><i class="fas fa-map-marker-alt"></i> Informasi Lokasi</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Lokasi Kegiatan</div>
                            <div class="view-info-value" id="view_lokasiKegiatan">-</div>
                </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Provinsi</div>
                            <div class="view-info-value" id="view_provinsi">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Kabupaten/Kota</div>
                            <div class="view-info-value" id="view_kabupaten">-</div>
                        </div>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="view-section">
                    <h5><i class="fas fa-money-bill-wave"></i> Informasi Keuangan</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Pagu Anggaran</div>
                            <div class="view-info-value" id="view_paguAnggaran">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Nilai Kontrak</div>
                            <div class="view-info-value" id="view_nilaiKontrak">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Realisasi</div>
                            <div class="view-info-value" id="view_realisasi">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Sisa Anggaran</div>
                            <div class="view-info-value" id="view_sisaAnggaran">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Sumber Dana</div>
                            <div class="view-info-value" id="view_sumberDana">-</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Information -->
                <div class="view-section">
                    <h5><i class="fas fa-chart-line"></i> Progress Kegiatan</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Progress Fisik</div>
                            <div class="view-progress-container">
                                <div class="view-progress-bar">
                                    <div class="view-progress-fill" id="view_progressFisikBar"></div>
                                </div>
                                <div class="view-progress-text" id="view_progressFisik">0%</div>
                            </div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Progress Keuangan</div>
                            <div class="view-progress-container">
                                <div class="view-progress-bar">
                                    <div class="view-progress-fill" id="view_progressKeuanganBar"></div>
                                </div>
                                <div class="view-progress-text" id="view_progressKeuangan">0%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contract Information -->
                <div class="view-section">
                    <h5><i class="fas fa-file-contract"></i> Informasi Kontrak</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">No. Kontrak</div>
                            <div class="view-info-value" id="view_noKontrak">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Tanggal Kontrak</div>
                            <div class="view-info-value" id="view_tanggalKontrak">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Tanggal Berakhir Kontrak</div>
                            <div class="view-info-value" id="view_tanggalBerakhirKontrak">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Metode Pengadaan</div>
                            <div class="view-info-value" id="view_metodePengadaan">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Penyedia</div>
                            <div class="view-info-value" id="view_penyedia">-</div>
                        </div>
                    </div>
                </div>

                <!-- Organization Information -->
                <div class="view-section">
                    <h5><i class="fas fa-building"></i> Informasi Organisasi</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Satuan Kerja</div>
                            <div class="view-info-value" id="view_satkerName">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">PIC Program</div>
                            <div class="view-info-value" id="view_picProgram">-</div>
                        </div>
                    </div>
                </div>

                <!-- Issues and Solutions -->
                <div class="view-section">
                    <h5><i class="fas fa-exclamation-triangle"></i> Hambatan & Mitigasi</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Hambatan</div>
                            <div class="view-info-value" id="view_hambatan">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Mitigasi</div>
                            <div class="view-info-value" id="view_mitigasi">-</div>
                        </div>
                    </div>
                </div>

                <!-- Timeline Information -->
                <div class="view-section">
                    <h5><i class="fas fa-calendar-alt"></i> Timeline</h5>
                    <div class="view-info-grid">
                        <div class="view-info-item">
                            <div class="view-info-label">Tanggal Mulai</div>
                            <div class="view-info-value" id="view_tanggalMulai">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Tanggal Selesai</div>
                            <div class="view-info-value" id="view_tanggalSelesai">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Dibuat</div>
                            <div class="view-info-value" id="view_createdAt">-</div>
                        </div>
                        <div class="view-info-item">
                            <div class="view-info-label">Terakhir Diupdate</div>
                            <div class="view-info-value" id="view_updatedAt">-</div>
                        </div>
                    </div>
                </div>

                <!-- Documentation Section -->
                <div class="view-section" id="view_dokumentasiSection" style="display: none;">
                    <h5><i class="fas fa-camera"></i> Dokumentasi Kegiatan</h5>
                    
                    <!-- Foto Sebelum -->
                    <div class="view-documentation-item" id="view_fotoBeforeContainer" style="display: none;">
                        <div class="view-info-label">
                            <i class="fas fa-image"></i> Foto Sebelum Kegiatan
                        </div>
                        <div class="view-documentation-content">
                            <a id="view_linkFotoBefore" href="#" target="_blank" class="view-doc-link">
                                <i class="fas fa-external-link-alt"></i> Lihat Foto Sebelum
                            </a>
                            <div id="view_fotoBeforePreview" class="view-doc-preview"></div>
                        </div>
                    </div>

                    <!-- Foto Sesudah -->
                    <div class="view-documentation-item" id="view_fotoAfterContainer" style="display: none;">
                        <div class="view-info-label">
                            <i class="fas fa-image"></i> Foto Sesudah Kegiatan
                        </div>
                        <div class="view-documentation-content">
                            <a id="view_linkFotoAfter" href="#" target="_blank" class="view-doc-link">
                                <i class="fas fa-external-link-alt"></i> Lihat Foto Sesudah
                            </a>
                            <div id="view_fotoAfterPreview" class="view-doc-preview"></div>
                        </div>
                    </div>

                    <!-- Dokumentasi Tambahan -->
                    <div class="view-documentation-item" id="view_dokumenTambahanContainer" style="display: none;">
                        <div class="view-info-label">
                            <i class="fas fa-file-alt"></i> Dokumentasi Tambahan
                        </div>
                        <div class="view-documentation-content" id="view_dokumenTambahanContent">
                            <!-- Multiple documents will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Kegiatan</h3>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            
            <form id="editForm">
                <div class="form-group">
                    <label>Nama Kegiatan *</label>
                    <input type="text" id="edit_namaKegiatan" required>
                </div>
                
                <div class="form-group">
                    <label>Nama Paket</label>
                    <input type="text" id="edit_namaPaket">
                </div>
                
                <div class="form-group">
                    <label>Pagu Anggaran (Rp) *</label>
                    <input type="number" id="edit_paguAnggaran" required>
                </div>
                
                <div class="form-group">
                    <label>Nilai Kontrak (Rp) *</label>
                    <input type="number" id="edit_nilaiKontrak" required>
                    <small style="color: #666; font-size: 0.8rem;">Nilai kontrak harus ≤ Pagu Anggaran</small>
                </div>
                
                <div class="form-group">
                    <label>Progress Keuangan (Rp)</label>
                    <input type="number" id="edit_progressKeuangan">
                </div>
                
                <div class="form-group">
                    <label>Progress Fisik (%)</label>
                    <input type="number" id="edit_progressFisik" min="0" max="100">
                </div>
                
                <div class="form-group">
                    <label>Lokasi Kegiatan</label>
                    <input type="text" id="edit_lokasiKegiatan" placeholder="Lokasi pelaksanaan kegiatan">
                </div>
                
                <div class="form-group">
                    <label>PIC Program</label>
                    <select id="edit_picProgram">
                        <option value="">-- Pilih Unit Kerja Eselon 2 --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Uraian Output</label>
                    <textarea id="edit_uraianOutput"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Indikator</label>
                    <textarea id="edit_indikator"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Target Output</label>
                    <textarea id="edit_targetOutput"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Hambatan</label>
                    <textarea id="edit_hambatan"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Mitigasi</label>
                    <textarea id="edit_mitigasi"></textarea>
                </div>
                
                <!-- Dokumentasi Section -->
                <div class="form-group">
                    <label>📸 Link Foto Sebelum Kegiatan</label>
                    <input type="url" id="edit_linkFotoBefore" placeholder="https://example.com/foto-sebelum.jpg">
                    <small style="color: #6b7280; font-size: 0.85rem;">
                        <i class="fas fa-info-circle"></i> Upload foto ke Google Drive, Dropbox, dll, lalu paste linknya
                    </small>
                    <div id="edit_fotoBeforePreview" class="link-preview" style="margin-top: 8px;"></div>
                </div>
                
                <div class="form-group">
                    <label>📸 Link Foto Sesudah Kegiatan</label>
                    <input type="url" id="edit_linkFotoAfter" placeholder="https://example.com/foto-sesudah.jpg">
                    <small style="color: #6b7280; font-size: 0.85rem;">
                        <i class="fas fa-info-circle"></i> Upload foto progress/hasil ke cloud storage
                    </small>
                    <div id="edit_fotoAfterPreview" class="link-preview" style="margin-top: 8px;"></div>
                </div>
                
                <div class="form-group">
                    <label>📄 Link Dokumentasi Tambahan</label>
                    <textarea id="edit_linkDokumentasi" rows="3" placeholder="https://example.com/dokumen1.pdf&#10;https://example.com/dokumen2.jpg&#10;https://example.com/dokumen3.png"></textarea>
                    <small style="color: #6b7280; font-size: 0.85rem;">
                        <i class="fas fa-info-circle"></i> Upload dokumen ke cloud storage, paste link-linknya di sini (satu link per baris)
                    </small>
                    <div id="edit_dokumenTambahanPreview" class="link-preview" style="margin-top: 8px;"></div>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button type="button" class="btn btn-primary" onclick="saveEditData()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- EMBEDDED SCRIPTS - NO EXTERNAL DEPENDENCIES -->
    <script>
        // EMBEDDED SATKER DATA
        const completeSatkerData = [
            // TINGKAT PUSAT - BIRO (5)
            { name: "Biro Perencanaan, Kerjasama, dan Hubungan Masyarakat", code: "BIRO_PERENCANAAN", type: "pusat", category: "biro", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "Biro Umum dan Layanan Pengadaan", code: "BIRO_UMUM", type: "pusat", category: "biro", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "Biro Keuangan dan BMN", code: "BIRO_KEUANGAN", type: "pusat", category: "biro", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "Biro Organisasi, SDM, dan Reformasi Birokrasi", code: "BIRO_ORGANISASI", type: "pusat", category: "biro", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "Biro Hukum", code: "BIRO_HUKUM", type: "pusat", category: "biro", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            
            // COMPLETE TEST SATKER - MAPPED TO REAL FIREBASE CODES
            { name: "nakerposo", code: "694568", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Poso" },
            { name: "nakermerauke", code: "694578", type: "satker", category: "satker", provinsi: "Papua Selatan", kabupaten: "Merauke" },
            { name: "nakersukamara", code: "694601", type: "satker", category: "satker", provinsi: "Kalimantan Tengah", kabupaten: "Sukamara" },
            { name: "nakerbanyuasin", code: "694559", type: "satker", category: "satker", provinsi: "Sumatera Selatan", kabupaten: "Banyuasin" },
            { name: "nakerlamandau", code: "694546", type: "satker", category: "satker", provinsi: "Kalimantan Tengah", kabupaten: "Lamandau" },
            { name: "nakertoraja", code: "694618", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Toraja Utara" },
            { name: "nakersumbatimur", code: "694577", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Sumba Timur" },
            { name: "nakersumbabarat", code: "694575", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Sumba Barat" },
            { name: "nakermamasa", code: "694599", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Mamasa" },
            { name: "nakersumbabaratdaya", code: "691673", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Sumba Barat Daya" },
            { name: "nakerbengkuluselatan", code: "694596", type: "satker", category: "satker", provinsi: "Bengkulu", kabupaten: "Bengkulu Selatan" },
            { name: "nakeracehbarat", code: "691643", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Aceh Barat" },
            { name: "nakergorontalo", code: "694584", type: "satker", category: "satker", provinsi: "Gorontalo", kabupaten: "Gorontalo" },
            { name: "nakerjambi", code: "691649", type: "satker", category: "satker", provinsi: "Jambi", kabupaten: "Jambi" },
            
            // BATCH 1 - 10 SATKER TAMBAHAN (BERTAHAP)
            { name: "nakerpengembangan1", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerpemberdayaan1", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerproduk1", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerbatam", code: "691702", type: "satker", category: "satker", provinsi: "Kepulauan Riau", kabupaten: "Batam" },
            { name: "nakerpromosi1", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerkeerom", code: "691698", type: "satker", category: "satker", provinsi: "Papua", kabupaten: "Keerom" },
            { name: "nakerpolewali", code: "691698", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Polewali Mandar" },
            { name: "nakerbenermeriah", code: "691701", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Bener Meriah" },
            { name: "nakermalukuutara", code: "691692", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Ternate" },
            { name: "nakersumbatimur2", code: "691700", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Sumba Timur" },
            
            // BATCH 2 - 10 SATKER TAMBAHAN (BERTAHAP)
            { name: "nakerkutaitimur", code: "691696", type: "satker", category: "satker", provinsi: "Kalimantan Timur", kabupaten: "Kutai Timur" },
            { name: "nakermesuji", code: "691694", type: "satker", category: "satker", provinsi: "Lampung", kabupaten: "Mesuji" },
            { name: "nakersekretaris1", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakeraceh", code: "694544", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Banda Aceh" },
            { name: "nakeracehselatan", code: "694556", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Aceh Selatan" },
            { name: "nakeracehutara", code: "691641", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Aceh Utara" },
            { name: "nakerbenermeriah2", code: "691642", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Bener Meriah" },
            { name: "nakersimeulue", code: "694589", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Simeulue" },
            { name: "nakersubulussalam", code: "691640", type: "satker", category: "satker", provinsi: "Aceh", kabupaten: "Subulussalam" },
            { name: "nakerbangkabelitung", code: "694635", type: "satker", category: "satker", provinsi: "Bangka Belitung", kabupaten: "Pangkal Pinang" },
            
            // BATCH 3 - 10 SATKER TAMBAHAN (BERTAHAP)
            { name: "nakerbangkaselatan", code: "694664", type: "satker", category: "satker", provinsi: "Bangka Belitung", kabupaten: "Bangka Selatan" },
            { name: "nakerbanten", code: "694582", type: "satker", category: "satker", provinsi: "Banten", kabupaten: "Serang" },
            { name: "nakerbengkulu", code: "694579", type: "satker", category: "satker", provinsi: "Bengkulu", kabupaten: "Bengkulu" },
            { name: "nakerbengkuluutara", code: "694662", type: "satker", category: "satker", provinsi: "Bengkulu", kabupaten: "Bengkulu Utara" },
            { name: "nakerjakarta", code: "694644", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerboalemo", code: "691663", type: "satker", category: "satker", provinsi: "Gorontalo", kabupaten: "Boalemo" },
            { name: "nakergorontaloprov", code: "694583", type: "satker", category: "satker", provinsi: "Gorontalo", kabupaten: "Gorontalo" },
            { name: "nakergorontalokab", code: "694584", type: "satker", category: "satker", provinsi: "Gorontalo", kabupaten: "Gorontalo" },
            { name: "nakergorontaloutara", code: "694595", type: "satker", category: "satker", provinsi: "Gorontalo", kabupaten: "Gorontalo Utara" },
            { name: "nakertanjungjabungtimur", code: "691650", type: "satker", category: "satker", provinsi: "Jambi", kabupaten: "Tanjung Jabung Timur" },
            
            // BATCH 4 - SATKER SISANYA (FINAL BATCH)
            { name: "nakerjawabaratprov", code: "694552", type: "satker", category: "satker", provinsi: "Jawa Barat", kabupaten: "Bandung" },
            { name: "nakerjawatengahprov", code: "694553", type: "satker", category: "satker", provinsi: "Jawa Tengah", kabupaten: "Semarang" },
            { name: "nakerjawaTimurprov", code: "694555", type: "satker", category: "satker", provinsi: "Jawa Timur", kabupaten: "Surabaya" },
            { name: "nakerkalimantan_barat", code: "694562", type: "satker", category: "satker", provinsi: "Kalimantan Barat", kabupaten: "Pontianak" },
            { name: "nakerkayongutara", code: "691657", type: "satker", category: "satker", provinsi: "Kalimantan Barat", kabupaten: "Kayong Utara" },
            { name: "nakerkuburaya", code: "691656", type: "satker", category: "satker", provinsi: "Kalimantan Barat", kabupaten: "Kubu Raya" },
            { name: "nakersambas", code: "691655", type: "satker", category: "satker", provinsi: "Kalimantan Barat", kabupaten: "Sambas" },
            { name: "nakersintang", code: "694597", type: "satker", category: "satker", provinsi: "Kalimantan Barat", kabupaten: "Sintang" },
            { name: "nakerbaritokuala", code: "694565", type: "satker", category: "satker", provinsi: "Kalimantan Selatan", kabupaten: "Barito Kuala" },
            { name: "nakerkalimantan_selatan", code: "691661", type: "satker", category: "satker", provinsi: "Kalimantan Selatan", kabupaten: "Banjarmasin" },
            { name: "nakertanahbumbu", code: "694654", type: "satker", category: "satker", provinsi: "Kalimantan Selatan", kabupaten: "Tanah Bumbu" },
            { name: "nakerkalimantan_tengah", code: "694564", type: "satker", category: "satker", provinsi: "Kalimantan Tengah", kabupaten: "Palangka Raya" },
            { name: "nakerkapuas", code: "694563", type: "satker", category: "satker", provinsi: "Kalimantan Tengah", kabupaten: "Kapuas" },
            { name: "nakerkotawaringinbarat", code: "691658", type: "satker", category: "satker", provinsi: "Kalimantan Tengah", kabupaten: "Kotawaringin Barat" },
            { name: "nakerkalimantan_timur", code: "691659", type: "satker", category: "satker", provinsi: "Kalimantan Timur", kabupaten: "Samarinda" },
            { name: "nakerkalimantan_utara", code: "694591", type: "satker", category: "satker", provinsi: "Kalimantan Utara", kabupaten: "Tarakan" },
            { name: "nakerpaser", code: "694566", type: "satker", category: "satker", provinsi: "Kalimantan Timur", kabupaten: "Paser" },
            { name: "nakerbulungan", code: "694592", type: "satker", category: "satker", provinsi: "Kalimantan Utara", kabupaten: "Bulungan" },
            { name: "nakerkepri", code: "691647", type: "satker", category: "satker", provinsi: "Kepulauan Riau", kabupaten: "Tanjung Pinang" },
            
            // BATCH 30-1: 30 SATKER BERIKUTNYA
            { name: "nakerlampung", code: "694561", type: "satker", category: "satker", provinsi: "Lampung", kabupaten: "Bandar Lampung" },
            { name: "nakermaluku", code: "691681", type: "satker", category: "satker", provinsi: "Maluku", kabupaten: "Ambon" },
            { name: "nakermalukutengah", code: "691682", type: "satker", category: "satker", provinsi: "Maluku", kabupaten: "Maluku Tengah" },
            { name: "nakerhalmaherapselatan", code: "691685", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Halmahera Selatan" },
            { name: "nakerhalmaheratengah", code: "694631", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Halmahera Tengah" },
            { name: "nakerhalmahearatimur", code: "694632", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Halmahera Timur" },
            { name: "nakerhalmaherautara", code: "691684", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Halmahera Utara" },
            { name: "nakerkepulauansula", code: "694658", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Kepulauan Sula" },
            { name: "nakerpulaumorotai", code: "691683", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Pulau Morotai" },
            { name: "nakertidorekepulauan", code: "694581", type: "satker", category: "satker", provinsi: "Maluku Utara", kabupaten: "Tidore Kepulauan" },
            { name: "nakerbima", code: "694622", type: "satker", category: "satker", provinsi: "Nusa Tenggara Barat", kabupaten: "Bima" },
            { name: "nakerlomboktimur", code: "691669", type: "satker", category: "satker", provinsi: "Nusa Tenggara Barat", kabupaten: "Lombok Timur" },
            { name: "nakerntb", code: "694621", type: "satker", category: "satker", provinsi: "Nusa Tenggara Barat", kabupaten: "Mataram" },
            { name: "nakersumbabarat", code: "694575", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Sumba Barat" },
            { name: "nakeralor", code: "691672", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Alor" },
            { name: "nakerbelu", code: "694625", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Belu" },
            { name: "nakerenda", code: "691671", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Ende" },
            { name: "nakerflorestimur", code: "691677", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Flores Timur" },
            { name: "nakerkupang", code: "691679", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Kupang" },
            { name: "nakermalaka", code: "694548", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Malaka" },
            { name: "nakermanggaraibarat", code: "691670", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Manggarai Barat" },
            { name: "nakernagekeo", code: "694649", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Nagekeo" },
            { name: "nakerngada", code: "691676", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Ngada" },
            { name: "nakerntt", code: "694576", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Kupang" },
            { name: "nakerrotendao", code: "691680", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Rote Ndao" },
            { name: "nakersaburaijua", code: "691675", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Sabu Raijua" },
            { name: "nakertimortengahselatan", code: "691678", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Timor Tengah Selatan" },
            { name: "nakertimortengahutara", code: "691674", type: "satker", category: "satker", provinsi: "Nusa Tenggara Timur", kabupaten: "Timor Tengah Utara" },
            { name: "nakerjayapura", code: "691690", type: "satker", category: "satker", provinsi: "Papua", kabupaten: "Jayapura" },
            { name: "nakerpapua", code: "691689", type: "satker", category: "satker", provinsi: "Papua", kabupaten: "Jayapura" },
            { name: "nakerfakfak", code: "694586", type: "satker", category: "satker", provinsi: "Papua Barat", kabupaten: "Fak-Fak" },
            
            // BATCH 30-2: 30 SATKER BERIKUTNYA
            { name: "nakermanokwari", code: "691687", type: "satker", category: "satker", provinsi: "Papua Barat", kabupaten: "Manokwari" },
            { name: "nakermanokwariselatan", code: "691688", type: "satker", category: "satker", provinsi: "Papua Barat", kabupaten: "Manokwari Selatan" },
            { name: "nakerpapuabarat", code: "694585", type: "satker", category: "satker", provinsi: "Papua Barat", kabupaten: "Manokwari" },
            { name: "nakertelukwondama", code: "694587", type: "satker", category: "satker", provinsi: "Papua Barat", kabupaten: "Teluk Wondama" },
            { name: "nakerpapuabaratdaya", code: "691686", type: "satker", category: "satker", provinsi: "Papua Barat Daya", kabupaten: "Sorong" },
            { name: "nakersorong", code: "694656", type: "satker", category: "satker", provinsi: "Papua Barat Daya", kabupaten: "Sorong" },
            { name: "nakerpapuaselatan", code: "694663", type: "satker", category: "satker", provinsi: "Papua Selatan", kabupaten: "Merauke" },
            { name: "nakerbengkalis", code: "691646", type: "satker", category: "satker", provinsi: "Riau", kabupaten: "Bengkalis" },
            { name: "nakerriau", code: "691645", type: "satker", category: "satker", provinsi: "Riau", kabupaten: "Pekanbaru" },
            { name: "nakermajene", code: "694549", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Majene" },
            { name: "nakermamuju", code: "691664", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Mamuju" },
            { name: "nakermamujutengah", code: "694551", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Mamuju Tengah" },
            { name: "nakerpasangkayu", code: "694550", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Pasangkayu" },
            { name: "nakersulawesibarat", code: "694588", type: "satker", category: "satker", provinsi: "Sulawesi Barat", kabupaten: "Mamuju" },
            { name: "nakerenrekang", code: "691667", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Enrekang" },
            { name: "nakerluwutimur", code: "694572", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Luwu Timur" },
            { name: "nakerluwuutara", code: "694616", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Luwu Utara" },
            { name: "nakersidenrengrappang", code: "694594", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Sidenreng Rappang" },
            { name: "nakersulawesiselatan", code: "694570", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Makassar" },
            { name: "nakerwajo", code: "694571", type: "satker", category: "satker", provinsi: "Sulawesi Selatan", kabupaten: "Wajo" },
            { name: "nakerbuol", code: "694661", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Buol" },
            { name: "nakermorowali", code: "691666", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Morowali" },
            { name: "nakermorowaliutara", code: "691665", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Morowali Utara" },
            { name: "nakersigi", code: "694569", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Sigi" },
            { name: "nakersulawesitengah", code: "694567", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Palu" },
            { name: "nakertojouna", code: "694655", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Tojo Una-Una" },
            { name: "nakertolitoli", code: "694593", type: "satker", category: "satker", provinsi: "Sulawesi Tengah", kabupaten: "Toli-Toli" },
            { name: "nakerkonawe", code: "694573", type: "satker", category: "satker", provinsi: "Sulawesi Tenggara", kabupaten: "Konawe" },
            { name: "nakerkonaweutara", code: "694574", type: "satker", category: "satker", provinsi: "Sulawesi Tenggara", kabupaten: "Konawe Utara" },
            { name: "nakerkonaweselatan", code: "691668", type: "satker", category: "satker", provinsi: "Sulawesi Tenggara", kabupaten: "Konawe Selatan" },
            { name: "nakermuna", code: "694600", type: "satker", category: "satker", provinsi: "Sulawesi Tenggara", kabupaten: "Muna" },
            
            // BATCH 30-3 (FINAL): SATKER SISANYA
            { name: "nakersulawesitenggara", code: "694547", type: "satker", category: "satker", provinsi: "Sulawesi Tenggara", kabupaten: "Kendari" },
            { name: "nakerpesisirselatan", code: "691644", type: "satker", category: "satker", provinsi: "Sumatera Barat", kabupaten: "Pesisir Selatan" },
            { name: "nakersijunjung", code: "694558", type: "satker", category: "satker", provinsi: "Sumatera Barat", kabupaten: "Sijunjung" },
            { name: "nakersumaterabarat", code: "694557", type: "satker", category: "satker", provinsi: "Sumatera Barat", kabupaten: "Padang" },
            { name: "nakerlahat", code: "691652", type: "satker", category: "satker", provinsi: "Sumatera Selatan", kabupaten: "Lahat" },
            { name: "nakeroganilir", code: "691651", type: "satker", category: "satker", provinsi: "Sumatera Selatan", kabupaten: "Ogan Ilir" },
            { name: "nakerokuTimur", code: "691653", type: "satker", category: "satker", provinsi: "Sumatera Selatan", kabupaten: "OKU Timur" },
            { name: "nakerpali", code: "694545", type: "satker", category: "satker", provinsi: "Sumatera Selatan", kabupaten: "PALI" },
            { name: "nakersumateraselatan", code: "694560", type: "satker", category: "satker", provinsi: "Sumatera Selatan", kabupaten: "Palembang" },
            { name: "nakeryogyakarta", code: "694554", type: "satker", category: "satker", provinsi: "DI Yogyakarta", kabupaten: "Yogyakarta" },
            { name: "nakersulawesiutara", code: "691110", type: "satker", category: "satker", provinsi: "Sulawesi Utara", kabupaten: "Manado" },
            { name: "nakerdirjenpengembangan", code: "694590", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerdirjenpembangunan1", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerdirjenpembangunan2", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerdirjenpembangunan3", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerdirjenpembangunan4", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerdirjenpembangunan5", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerdirjenpembangunan6", code: "694652", type: "satker", category: "satker", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "nakerbalaiYogyakarta", code: "699607", type: "satker", category: "satker", provinsi: "DI Yogyakarta", kabupaten: "Yogyakarta" },
            { name: "nakerbalaibanjarmasin", code: "699723", type: "satker", category: "satker", provinsi: "Kalimantan Selatan", kabupaten: "Banjarmasin" },
            { name: "nakerbalaidenpasar", code: "691055", type: "satker", category: "satker", provinsi: "Bali", kabupaten: "Denpasar" },
            { name: "nakerbalaipekanbaru", code: "695378", type: "satker", category: "satker", provinsi: "Riau", kabupaten: "Pekanbaru" },
            { name: "nakersumaterautara", code: "699681", type: "satker", category: "satker", provinsi: "Sumatera Utara", kabupaten: "Medan" },
            { name: "nakerbali", code: "695650", type: "satker", category: "satker", provinsi: "Bali", kabupaten: "Denpasar" },
            
            { name: "admin", code: "ADMIN", type: "admin", category: "admin", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" },
            { name: "superadmin", code: "SUPER_ADMIN", type: "admin", category: "admin", provinsi: "DKI Jakarta", kabupaten: "Jakarta Pusat" }
        ];

        // EMBEDDED SIMPLE AUTH SYSTEM
        window.SimpleAuth = {
            getCurrentUser: function() {
                try {
                    const userData = localStorage.getItem('satker_current_user');
                    if (userData) {
                        const user = JSON.parse(userData);
                        if (user && user.username) {
                            return user;
                        }
                    }
                    return null;
                } catch (error) {
                    console.warn('Error getting user:', error);
                    return null;
                }
            },

            login: function(username, password) {
                try {
                    const users = this.getUsers();
                    const user = users.find(u => u.username === username && u.password === password);
                   
                    if (user) {
                        localStorage.setItem('satker_current_user', JSON.stringify(user));
                        return { success: true, user: user };
                    } else {
                        return { success: false, error: 'Username atau password salah' };
                    }
                } catch (error) {
                    return { success: false, error: 'System error' };
                }
            },

            getUsers: function() {
                try {
                    // FORCE REFRESH - Always recreate users to use latest satker codes
                    console.log('🔧 Creating users from latest completeSatkerData...');
                    const users = this.createAllUsers();
                    
                    // Clear old cache and save new data
                    localStorage.removeItem('satker_users_db');
                    localStorage.setItem('satker_users_db', JSON.stringify(users));
                    console.log('💾 Users refreshed with latest satker codes');
                   
                    return users;
                } catch (error) {
                    return this.createAllUsers();
                }
            },

            createAllUsers: function() {
                const users = [];
               
                // Add super admin
                users.push({
                    username: 'superadmin',
                    password: 'admin123',
                    fullName: 'Super Administrator',
                    role: 'super_admin',
                    satkerCode: 'ALL',
                    satkerName: 'All Satuan Kerja'
                });
               
                // Create users from satker data
                completeSatkerData.forEach((satker, index) => {
                    const username = this.generateUsername(satker.name);
                   
                    users.push({
                        username: username,
                        password: 'password123',
                        fullName: satker.name,
                        role: 'satker_admin',
                        satkerCode: satker.code || username.toUpperCase(),
                        satkerName: satker.name,
                        satkerData: satker
                    });
                });
               
                return users;
            },

            generateUsername: function(name) {
                return name.toLowerCase()
                    .replace(/[^a-z0-9\\s]/g, '')
                    .replace(/\\s+/g, '')
                    .substring(0, 20);
            }
        };

        console.log('✅ All scripts embedded in dashboard - no external dependencies!');
        // Note: initializeDashboard will be called after all functions are defined
    </script>
    
    <!-- Firebase SDK - EMBEDDED FOR HOSTING COMPATIBILITY -->
    <script type="module">
        // Use stable Firebase SDK version
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, updateDoc, doc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';

        // Firebase configuration - SAME AS EXECUTIVE DASHBOARD
        const firebaseConfig = {
            apiKey: "AIzaSyBcetwoMXOnXuU60WSaUaUce-g1GVSDmWE",
            authDomain: "dashboard-kementrans.firebaseapp.com",
            projectId: "dashboard-kementrans",
            storageBucket: "dashboard-kementrans.firebasestorage.app",
            messagingSenderId: "852941680228",
            appId: "1:852941680228:web:57f9502b71e246ea8e7971",
            measurementId: "G-MRMNSD561Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global variables
        let currentUser = null;
        let allProgressData = [];
        let filteredData = [];
        let currentEditId = null;

        // Initialize dashboard with embedded scripts
        function initializeDashboard() {
            console.log('🚀 Initializing dashboard with embedded scripts...');
            checkAuth();
            loadData();
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 DOM ready - initializing dashboard...');
            initializeDashboard();
        });
        
        // Also initialize immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            // DOM is still loading, wait for DOMContentLoaded
        } else {
            // DOM is already loaded
            console.log('📄 DOM already ready - initializing dashboard immediately...');
            initializeDashboard();
        }

        function checkAuth() {
            // Use embedded SimpleAuth (always available)
            currentUser = window.SimpleAuth.getCurrentUser();
            
            if (!currentUser) {
                console.log('❌ No user found, redirecting to login...');
                window.location.href = 'login.html';
                    return;
                }
            
            console.log('✅ User authenticated:', currentUser);
            console.log('🏢 User satker:', currentUser.satkerCode, '-', currentUser.satkerName);
            
            // Update user info in header
            const userRoleElement = document.getElementById('userRole');
            const userSatkerElement = document.getElementById('userSatker');
            
            if (userRoleElement) {
                userRoleElement.textContent = currentUser.role === 'super_admin' ? 'Super Administrator' : 'Admin Satker';
            }
            if (userSatkerElement) {
                userSatkerElement.textContent = currentUser.satkerName || 'All Satuan Kerja';
            }
        }

        // Improved matching function for satker codes
        function isCodeMatch(dataCode, userCode) {
            if (!dataCode || !userCode) return false;
            
            // Exact match
            if (dataCode === userCode) return true;
            
            // Convert to strings for comparison
            const dataStr = dataCode.toString().trim();
            const userStr = userCode.toString().trim();
            
            // Check if user code is contained in data code
            if (dataStr.includes(userStr)) return true;
            if (userStr.includes(dataStr)) return true;
            
            // Check for numeric pattern matching
            const dataNumbers = dataStr.match(/\d+/g) || [];
            const userNumbers = userStr.match(/\d+/g) || [];
            
            // If any number matches, it's a match
            for (const dataNum of dataNumbers) {
                for (const userNum of userNumbers) {
                    if (dataNum === userNum) {
                        console.log(`🔍 DEBUG: Numeric match found: ${dataNum} in ${dataStr} vs ${userStr}`);
                        return true;
                    }
                }
            }
            
            // Special case: Check if user code contains location name that matches data
            // Extract location from user code (e.g., "POSO" from "SATKER_POSO_696994")
            const userLocation = userStr.match(/[A-Z]+/g) || [];
            const dataLocation = dataStr.match(/[A-Z]+/g) || [];
            
            for (const userLoc of userLocation) {
                for (const dataLoc of dataLocation) {
                    if (userLoc === dataLoc) {
                        console.log(`🔍 DEBUG: Location match found: ${userLoc} in ${dataStr} vs ${userStr}`);
                        return true;
                    }
                }
            }
            
            // Check if data satkerCode is in user's viewableBy array
            // This is handled in the main filtering logic, but adding here as backup
            
            // Additional debug logging
            console.log(`🔍 DEBUG: No match between "${dataStr}" and "${userStr}"`);
            return false;
        }

        // CORRECT SATKER-BASED FILTERING - Show data FOR this satker organization
        // Logic: If data belongs to same satker organization (regardless of location), show it
        function isSameSatkerOrganization(dataSatkerName, userSatkerName, dataItem = null) {
            if (!dataSatkerName || !userSatkerName) return false;
            
            console.log(`🔍 DEBUG: SATKER ORGANIZATION MATCHING:`);
            console.log(`📋 Data satker: "${dataSatkerName}"`);
            console.log(`👤 User satker: "${userSatkerName}"`);
            
            // STEP 1: Exact name match
            if (dataSatkerName.toLowerCase().trim() === userSatkerName.toLowerCase().trim()) {
                console.log(`✅ DEBUG: EXACT SATKER NAME MATCH`);
                return true;
            }
            
            // STEP 2: Fuzzy organization matching (for multiple codes of same satker)
            const normalize = (name) => name.toLowerCase()
                .replace(/[^a-z0-9\s]/g, '')
                .replace(/\s+/g, ' ')
                .trim();

            const dataName = normalize(dataSatkerName);
            const userName = normalize(userSatkerName);

            if (dataName === userName) {
                console.log(`✅ DEBUG: NORMALIZED SATKER NAME MATCH`);
                return true;
            }

            // STEP 3: Key words matching (for same organization with different naming)
            const commonWords = ['dinas', 'kota', 'kabupaten', 'provinsi', 'dan', 'tenaga', 'kerja', 'transmigrasi', 'atau', 'badan', 'kantor', 'balai', 'perumahan', 'rakyat', 'permukiman', 'pertamanan'];
            const getKeyWords = (name) => name.split(' ')
                .filter(word => word.length > 2 && !commonWords.includes(word));

            const dataWords = getKeyWords(dataName);
            const userWords = getKeyWords(userName);

            if (dataWords.length === 0 || userWords.length === 0) {
                console.log(`❌ DEBUG: Insufficient key words for matching`);
                return false;
            }

            let matchCount = 0;
            dataWords.forEach(dWord => {
                if (userWords.some(uWord => uWord.includes(dWord) || dWord.includes(uWord))) {
                    matchCount++;
                }
            });

            const similarity = matchCount / Math.max(dataWords.length, userWords.length);
            console.log(`🔍 DEBUG: Organization similarity: ${similarity.toFixed(2)} (${matchCount}/${Math.max(dataWords.length, userWords.length)})`);
            
            if (similarity > 0.7) { // 70% similarity threshold
                console.log(`✅ DEBUG: FUZZY SATKER ORGANIZATION MATCH`);
                return true;
            }

            console.log(`❌ DEBUG: No satker organization match`);
            return false;
        }


        // MOCK DATA REMOVED - ONLY USE FIREBASE DATA

        async function loadData() {
            try {
                const currentUser = window.SimpleAuth?.getCurrentUser();
                if (!currentUser) return;

                console.log('🔄 Loading data for user:', currentUser.username, 'SatkerCode:', currentUser.satkerCode);

                let allData = [];
                
                // Try localStorage first (same as executive-dashboard)
                console.log('📱 Loading data from localStorage...');
                const localData = localStorage.getItem('satker_progress_data');
                if (localData) {
                    allData = JSON.parse(localData);
                    console.log(`✅ Found ${allData.length} records in localStorage`);
                }

                // Try Firebase if localStorage is empty
                if (allData.length === 0) {
                    console.log('📡 Loading data from Firebase...');
                    const progressRef = collection(db, 'progress_data');
                    const snapshot = await getDocs(progressRef);
                    
                    console.log('📊 Firebase data loaded:', snapshot.size, 'documents');
                        
                    if (snapshot.size === 0) {
                        console.log('⚠️ No data in Firebase for this user');
                        displayNoData();
                        return;
                    }
                    
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        data.id = doc.id;
                        data.firebaseId = doc.id;
                        allData.push(data);
                    });
                    
                    console.log(`✅ Found ${allData.length} records in Firebase`);
                }
                
                // Filter data based on user permissions (same as executive-dashboard)
                allProgressData = [];
                const seenIds = new Set(); // To prevent duplicates
                
                allData.forEach((data) => {
                    // Ensure data has proper ID
                    if (!data.id && data.firebaseId) {
                        data.id = data.firebaseId;
                    }
                    
                    // Skip if already seen (duplicate)
                    if (seenIds.has(data.id)) {
                        return;
                    }
                    seenIds.add(data.id);
                    
                    // DEBUG: Filter based on user role and permissions
                    console.log('🔍 DEBUG: Checking item:', data.namaKegiatan);
                    console.log('🔍 DEBUG: Item satkerCode:', data.satkerCode);
                    console.log('🔍 DEBUG: Item viewableBy:', data.viewableBy);
                    console.log('🔍 DEBUG: Item viewableBy content:', JSON.stringify(data.viewableBy));
                    console.log('🔍 DEBUG: User satkerCode:', currentUser.satkerCode);
                    console.log('🔍 DEBUG: User role:', currentUser.role);
                    
                    if (currentUser.role === 'super_admin') {
                        console.log('✅ DEBUG: Super admin - adding item');
                        allProgressData.push(data);
                    } else if (data.satkerCode === currentUser.satkerCode || String(data.satkerCode).trim() === String(currentUser.satkerCode).trim()) {
                        console.log('✅ DEBUG: SatkerCode exact match - adding item');
                        allProgressData.push(data);
                    } else if (data.viewableBy && (data.viewableBy.includes(currentUser.satkerCode) || data.viewableBy.includes(String(currentUser.satkerCode).trim()))) {
                        console.log('✅ DEBUG: ViewableBy match - adding item');
                        allProgressData.push(data);
                    } else if (isCodeMatch(data.satkerCode, currentUser.satkerCode)) {
                        console.log('✅ DEBUG: Flexible match - adding item');
                        allProgressData.push(data);
                    } else if (isSameSatkerOrganization(data.satkerName, currentUser.satkerName, data)) {
                        console.log('✅ DEBUG: Geographic/organization match - adding item');
                        console.log('✅ DEBUG: Data satker name:', data.satkerName);
                        console.log('✅ DEBUG: User satker name:', currentUser.satkerName);
                        allProgressData.push(data);
                    } else {
                        console.log('❌ DEBUG: No match - skipping item');
                        console.log('❌ DEBUG: Data satkerCode:', data.satkerCode, 'Type:', typeof data.satkerCode);
                        console.log('❌ DEBUG: User satkerCode:', currentUser.satkerCode, 'Type:', typeof currentUser.satkerCode);
                        console.log('❌ DEBUG: Exact match test:', data.satkerCode === currentUser.satkerCode);
                        console.log('❌ DEBUG: String comparison:', String(data.satkerCode) === String(currentUser.satkerCode));
                    }
                });

                console.log('👤 Current user:', currentUser.role, currentUser.satkerCode);
                console.log('📋 Sample data:', allProgressData.slice(0, 2));
                
                filteredData = [...allProgressData];
                populateFilterDropdowns();
                updateStatistics();
                displayData();
                    
                } catch (error) {
                console.error('❌ Error loading data from Firebase:', error);
                displayError('Error loading data: ' + error.message);
            }
        }

        function populateFilterDropdowns() {
            // Get unique values for each filter
            const satkers = [...new Set(allProgressData.map(item => item.satkerName || item.satkerCode).filter(Boolean))];
            const lokasis = [...new Set(allProgressData.map(item => item.lokasi || item.lokasiKegiatan).filter(Boolean))];
            const picValues = allProgressData.map(item => item.picProgram || item.pic).filter(Boolean);
            const picMap = new Map();
            picValues.forEach(pic => {
                if (pic && pic.trim()) {
                    const normalized = pic.trim().toUpperCase();
                    if (!picMap.has(normalized)) {
                        picMap.set(normalized, pic.trim());
                    }
                }
            });
            const pics = Array.from(picMap.values()).sort();
            
            // Populate Satker dropdown
            const satkerSelect = document.getElementById('satkerFilter');
            satkerSelect.innerHTML = '<option value="">Semua Satker</option>';
            satkers.forEach(satker => {
                const option = document.createElement('option');
                option.value = satker;
                option.textContent = satker;
                satkerSelect.appendChild(option);
            });
            
            // Populate Lokasi dropdown
            const lokasiSelect = document.getElementById('lokasiFilter');
            lokasiSelect.innerHTML = '<option value="">Semua Lokasi</option>';
            lokasis.forEach(lokasi => {
                const option = document.createElement('option');
                option.value = lokasi;
                option.textContent = lokasi;
                lokasiSelect.appendChild(option);
            });
            
            // Populate PIC dropdown
            const picSelect = document.getElementById('picFilter');
            picSelect.innerHTML = '<option value="">Semua PIC</option>';
            pics.forEach(pic => {
                const option = document.createElement('option');
                option.value = pic;
                option.textContent = pic;
                picSelect.appendChild(option);
            });
        }

        function updateStatistics() {
            const total = filteredData.length;
            const totalBudget = filteredData.reduce((sum, item) => sum + (parseFloat(item.paguAnggaran) || 0), 0);
            const avgProgress = total > 0 ? filteredData.reduce((sum, item) => sum + (parseFloat(item.progressFisik) || 0), 0) / total : 0;
            const completed = filteredData.filter(item => (parseFloat(item.progressFisik) || 0) >= 100).length;

            // Update ringkasan data cards
            document.getElementById('totalData').textContent = total;
            document.getElementById('totalBudget').textContent = formatCurrency(totalBudget);
            document.getElementById('avgProgress').textContent = avgProgress.toFixed(1) + '%';
            document.getElementById('completedData').textContent = completed;
            
            // Update data count
            document.getElementById('dataCount').textContent = `${total} data`;
        }

        function displayNoData() {
            const dataList = document.getElementById('dataList');
            if (dataList) {
                dataList.innerHTML = '<div class="alert alert-info">No data available for this satker</div>';
            }
            
            // Clear statistics
            document.getElementById('totalProjects').textContent = '0';
            document.getElementById('completedProjects').textContent = '0';
            document.getElementById('inProgressProjects').textContent = '0';
            document.getElementById('totalBudget').textContent = 'Rp 0';
        }

        function displayError(message) {
            const dataList = document.getElementById('dataList');
            if (dataList) {
                dataList.innerHTML = `<div class="alert alert-danger">Error: ${message}</div>`;
            }
        }

        function displayData() {
            console.log('🔄 Displaying data...');
            console.log('📊 filteredData length:', filteredData.length);
            console.log('📊 allProgressData length:', allProgressData.length);
            
            const dataList = document.getElementById('dataList');
            if (!dataList) {
                console.error('❌ dataList element not found!');
                return;
            }
            
            if (filteredData.length === 0) {
                console.log('⚠️ No data to display');
                dataList.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 16px; color: #cbd5e1;"></i>
                        <p>Tidak ada data</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredData.forEach((item, index) => {
                const progress = parseFloat(item.progressFisik) || 0;
                
                html += `
                    <div class="data-item" onclick="viewData('${item.id}')">
                        <div class="data-item-header">
                            <div class="data-item-title">${item.indikator || item.kegiatan || 'Kegiatan tidak disebutkan'}</div>
                            <div class="data-item-number">${index + 1}</div>
                        </div>
                        
                        <div class="data-item-meta">
                            <div class="meta-item">
                                <i class="fas fa-map-marker-alt meta-icon"></i>
                                <span>${item.lokasi || 'Lokasi tidak disebutkan'}</span>
                        </div>
                            <div class="meta-item">
                                <i class="fas fa-user meta-icon"></i>
                                <span>${item.picProgram || 'PIC tidak disebutkan'}</span>
                            </div>
                        </div>
                        
                        <div class="data-item-amount">
                            ${formatCurrency(item.paguAnggaran)}
                        </div>
                        
                        <div class="data-item-actions">
                            <button class="action-btn primary" data-item-id="${item.id}">
                                <i class="fas fa-eye"></i>
                                Detail
                            </button>
                            <button class="action-btn secondary" data-item-id="${item.id}">
                                <i class="fas fa-edit"></i>
                                Edit
                            </button>
                        </div>
                    </div>
            `;
            });
            
            dataList.innerHTML = html;
            
            // Add event listeners to action buttons
            const actionButtons = dataList.querySelectorAll('.action-btn');
            actionButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const itemId = this.getAttribute('data-item-id');
                    if (this.classList.contains('primary')) {
                        viewData(itemId);
                    } else if (this.classList.contains('secondary')) {
                        editData(itemId);
                    }
                });
            });
        }


        function formatCurrency(amount) {
            if (!amount || amount === 0) return 'Rp 0';
            
            if (amount >= 1000000000000) {
                return `Rp ${(amount / 1000000000000).toFixed(1)} Triliun`;
            } else if (amount >= 1000000000) {
                return `Rp ${(amount / 1000000000).toFixed(1)} Milyar`;
            } else if (amount >= 1000000) {
                return `Rp ${(amount / 1000000).toFixed(1)} Juta`;
                        } else {
                return `Rp ${amount.toLocaleString('id-ID')}`;
            }
        }

        function viewData(itemId) {
            console.log('View data:', itemId);
                
                const item = allProgressData.find(d => d.id === itemId);
                if (!item) {
                showMessage('Data tidak ditemukan', 'error');
                return;
            }

            // Populate view modal with all available data
            populateViewModal(item);
            
            // Show modal
            document.getElementById('viewModal').style.display = 'block';
        }

        function populateViewModal(item) {
            // Basic Information
            document.getElementById('view_namaKegiatan').textContent = item.namaKegiatan || item.kegiatan || '-';
            document.getElementById('view_namaPaket').textContent = item.namaPaket || '-';
            document.getElementById('view_indikator').textContent = item.indikator || '-';
            document.getElementById('view_targetOutput').textContent = item.targetOutput || '-';
            document.getElementById('view_uraianOutput').textContent = item.uraianOutput || '-';

            // Location Information
            document.getElementById('view_lokasiKegiatan').textContent = item.lokasiKegiatan || item.lokasi || '-';
            document.getElementById('view_provinsi').textContent = item.provinsi || '-';
            document.getElementById('view_kabupaten').textContent = item.kabupaten || '-';

            // Financial Information
            const paguAnggaran = parseFloat(item.paguAnggaran) || parseFloat(item.nilaiAnggaran) || 0;
                const nilaiKontrak = parseFloat(item.nilaiKontrak) || 0;
            const progressKeuangan = parseFloat(item.progressKeuangan) || 0;
            const progressFisik = parseFloat(item.progressFisik) || 0;
            const sisaAnggaran = paguAnggaran - progressKeuangan;

            document.getElementById('view_paguAnggaran').textContent = formatCurrency(paguAnggaran);
            document.getElementById('view_nilaiKontrak').textContent = formatCurrency(nilaiKontrak);
            document.getElementById('view_realisasi').textContent = formatCurrency(progressKeuangan);
            document.getElementById('view_sisaAnggaran').textContent = formatCurrency(sisaAnggaran);

            // Progress Information
            document.getElementById('view_progressFisik').textContent = progressFisik + '%';
            document.getElementById('view_progressFisikBar').style.width = progressFisik + '%';
            
            const progressKeuanganPct = nilaiKontrak > 0 ? (progressKeuangan / nilaiKontrak) * 100 : 0;
            document.getElementById('view_progressKeuangan').textContent = progressKeuanganPct.toFixed(1) + '%';
            document.getElementById('view_progressKeuanganBar').style.width = progressKeuanganPct + '%';

            // Organization Information
            document.getElementById('view_satkerName').textContent = item.satkerName || item.satkerCode || '-';
            document.getElementById('view_picProgram').textContent = item.picProgram || '-';

            // Issues and Solutions
            document.getElementById('view_hambatan').textContent = item.hambatan || item.kendalaHambatan || item.kendala || '-';
            document.getElementById('view_mitigasi').textContent = item.mitigasi || '-';
            
            // Documentation
            populateViewDocumentation(item.dokumentasi);

            // Timeline Information
            const formatDate = (dateString) => {
                if (!dateString) return '-';
                try {
                    return new Date(dateString).toLocaleDateString('id-ID', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                } catch {
                    return dateString;
                }
            };

            document.getElementById('view_tanggalMulai').textContent = formatDate(item.tanggalMulai);
            document.getElementById('view_tanggalSelesai').textContent = formatDate(item.tanggalSelesai);
            document.getElementById('view_createdAt').textContent = formatDate(item.createdAt);
            document.getElementById('view_updatedAt').textContent = formatDate(item.updatedAt);

            // Status Information
            const status = getProgressStatus(progressFisik);
            document.getElementById('view_statusBadge').textContent = status.text;
            document.getElementById('view_statusBadge').className = `badge ${status.class}`;

            // Additional Information
            document.getElementById('view_kodeKegiatan').textContent = item.kodeKegiatan || '-';
            document.getElementById('view_jenisKegiatan').textContent = item.jenisKegiatan || '-';
            document.getElementById('view_sumberDana').textContent = item.sumberDana || '-';
            document.getElementById('view_metodePengadaan').textContent = item.metodePengadaan || '-';
            document.getElementById('view_penyedia').textContent = item.penyedia || '-';
            document.getElementById('view_noKontrak').textContent = item.noKontrak || '-';
            document.getElementById('view_tanggalKontrak').textContent = formatDate(item.tanggalKontrak);
            document.getElementById('view_tanggalBerakhirKontrak').textContent = formatDate(item.tanggalBerakhirKontrak);
        }

        function editData(itemId) {
            console.log('Edit data:', itemId);
            
            const item = allProgressData.find(d => d.id === itemId);
                if (!item) {
                showMessage('Data tidak ditemukan', 'error');
                return;
            }
            
            // Populate edit form with current data
            populateEditForm(item);
            
            // Set current edit ID
            currentEditId = itemId;
            
            // Show modal
            document.getElementById('editModal').style.display = 'block';
            
            // Setup link preview handlers for edit modal
            setupEditLinkPreviewHandlers();
        }

        function populateEditForm(item) {
            // Basic Information
            document.getElementById('edit_namaKegiatan').value = item.namaKegiatan || item.kegiatan || '';
            document.getElementById('edit_namaPaket').value = item.namaPaket || '';
            // document.getElementById('edit_kodeKegiatan').value = item.kodeKegiatan || '';
            // document.getElementById('edit_jenisKegiatan').value = item.jenisKegiatan || '';
            document.getElementById('edit_indikator').value = item.indikator || '';
            document.getElementById('edit_targetOutput').value = item.targetOutput || '';
            document.getElementById('edit_uraianOutput').value = item.uraianOutput || '';

            // Location Information
            document.getElementById('edit_lokasiKegiatan').value = item.lokasiKegiatan || item.lokasi || '';
            // document.getElementById('edit_provinsi').value = item.provinsi || '';
            // document.getElementById('edit_kabupaten').value = item.kabupaten || '';

            // Financial Information
            const paguAnggaran = parseFloat(item.paguAnggaran) || parseFloat(item.nilaiAnggaran) || 0;
            const nilaiKontrak = parseFloat(item.nilaiKontrak) || 0;
            const progressKeuangan = parseFloat(item.progressKeuangan) || 0;
            const progressFisik = parseFloat(item.progressFisik) || 0;

            document.getElementById('edit_paguAnggaran').value = paguAnggaran;
            document.getElementById('edit_nilaiKontrak').value = nilaiKontrak;
            document.getElementById('edit_progressKeuangan').value = progressKeuangan;
            document.getElementById('edit_progressFisik').value = progressFisik;
            // document.getElementById('edit_sumberDana').value = item.sumberDana || '';
            
            // Dokumentasi links
            if (item.dokumentasi) {
                document.getElementById('edit_linkFotoBefore').value = item.dokumentasi.linkFotoBefore || '';
                document.getElementById('edit_linkFotoAfter').value = item.dokumentasi.linkFotoAfter || '';
                document.getElementById('edit_linkDokumentasi').value = 
                    Array.isArray(item.dokumentasi.linkDokumentasi) ? 
                    item.dokumentasi.linkDokumentasi.join('\n') : 
                    (item.dokumentasi.linkDokumentasi || '');
            }

            // Contract Information - commented out elements that don't exist
            // document.getElementById('edit_noKontrak').value = item.noKontrak || '';
            // document.getElementById('edit_metodePengadaan').value = item.metodePengadaan || '';
            // document.getElementById('edit_penyedia').value = item.penyedia || '';
            
            // Format dates for input - commented out elements that don't exist
            // const formatDateForInput = (dateString) => {
            //     if (!dateString) return '';
            //     try {
            //         return new Date(dateString).toISOString().split('T')[0];
            //     } catch {
            //         return '';
            //     }
            // };

            // document.getElementById('edit_tanggalKontrak').value = formatDateForInput(item.tanggalKontrak);
            // document.getElementById('edit_tanggalBerakhirKontrak').value = formatDateForInput(item.tanggalBerakhirKontrak);
            // document.getElementById('edit_tanggalMulai').value = formatDateForInput(item.tanggalMulai);
            // document.getElementById('edit_tanggalSelesai').value = formatDateForInput(item.tanggalSelesai);

            // Organization Information
            document.getElementById('edit_picProgram').value = item.picProgram || '';

            // Issues and Solutions
            document.getElementById('edit_hambatan').value = item.hambatan || item.kendalaHambatan || item.kendala || '';
            document.getElementById('edit_mitigasi').value = item.mitigasi || '';
            
            console.log('Edit form populated with data:', {
                namaKegiatan: item.namaKegiatan,
                paguAnggaran: paguAnggaran,
                progressFisik: progressFisik
            });
        }

        async function saveEditData() {
            try {
                if (!currentEditId) {
                    showMessage('No item selected for editing', 'error');
                    return;
                }
                
                console.log('💾 Starting save for:', currentEditId);
                
                // Get form data
                const namaKegiatan = document.getElementById('edit_namaKegiatan').value.trim();
                const paguAnggaran = parseFloat(document.getElementById('edit_paguAnggaran').value) || 0;
                const nilaiKontrak = parseFloat(document.getElementById('edit_nilaiKontrak').value) || 0;
                
                if (!namaKegiatan || !paguAnggaran) {
                    showMessage('Nama Kegiatan dan Pagu Anggaran wajib diisi', 'error');
                        return;
                }
                
                // Validate nilai kontrak <= pagu anggaran
                if (nilaiKontrak > 0 && nilaiKontrak > paguAnggaran) {
                    showMessage('Nilai kontrak tidak boleh lebih besar dari Pagu Anggaran!', 'error');
                    return;
                }
                
                // Validate progress fisik
                const progressFisik = parseFloat(document.getElementById('edit_progressFisik').value) || 0;
                if (progressFisik < 0 || progressFisik > 100) {
                    showMessage('Progress fisik harus antara 0% dan 100%!', 'error');
                    return;
                }
                
                // Helper function to safely get element value
                const getValue = (id) => {
                    const element = document.getElementById(id);
                    return element ? element.value.trim() : '';
                };
                
                const updatedData = {
                    // Basic info - only use elements that exist
                    namaKegiatan: namaKegiatan,
                    namaPaket: getValue('edit_namaPaket'),
                    indikator: getValue('edit_indikator'),
                    targetOutput: getValue('edit_targetOutput'),
                    uraianOutput: getValue('edit_uraianOutput'),
                    
                    // Location info - only use elements that exist
                    lokasiKegiatan: getValue('edit_lokasiKegiatan'),
                    
                    // Financial data
                    nilaiAnggaran: paguAnggaran, // Old field name (compatibility)
                    paguAnggaran: paguAnggaran,  // New field name
                    nilaiKontrak: nilaiKontrak,
                    progressKeuangan: parseFloat(getValue('edit_progressKeuangan')) || 0,
                    progressFisik: progressFisik,
                    
                    // Organization info - only use elements that exist
                    picProgram: getValue('edit_picProgram'),
                    
                    // Issues & solutions - only use elements that exist
                    hambatan: getValue('edit_hambatan'),
                    mitigasi: getValue('edit_mitigasi'),
                    
                    // Dokumentasi links
                    dokumentasi: {
                        linkFotoBefore: getValue('edit_linkFotoBefore'),
                        linkFotoAfter: getValue('edit_linkFotoAfter'),
                        linkDokumentasi: getValue('edit_linkDokumentasi').split('\n').filter(link => link.trim()),
                        updatedAt: new Date().toISOString()
                    },
                    
                    // Metadata
                    updatedAt: new Date().toISOString(),
                    lastEditedBy: currentUser?.username || 'unknown',
                    editTest: true,
                    editTimestamp: new Date().toISOString()
                };
                
                console.log('📝 Data to save:', updatedData);
                
                // Find item in local array
                const itemIndex = allProgressData.findIndex(d => d.id === currentEditId);
                if (itemIndex === -1) {
                    throw new Error('Item not found in local data');
                }

                // Update local data IMMEDIATELY
                allProgressData[itemIndex] = { ...allProgressData[itemIndex], ...updatedData };

                // Save to localStorage IMMEDIATELY
                localStorage.setItem('satker_progress_data', JSON.stringify(allProgressData));
                console.log('✅ Saved to localStorage');
                
                // Update UI IMMEDIATELY
                filteredData = [...allProgressData];
                updateStatistics();
                displayData();
                
                // Close modal IMMEDIATELY
                closeEditModal();
                
                // Save to Firebase in background
                let firebaseSuccess = false;
                
                    try {
                        const firebaseItem = allProgressData[itemIndex];
                        
                        if (firebaseItem.firebaseId) {
                            // Update existing
                        const docRef = doc(db, 'progress_data', firebaseItem.firebaseId);
                        await updateDoc(docRef, updatedData);
                            firebaseSuccess = true;
                            console.log('✅ Firebase update successful');
                        } else {
                            // Create new
                        const docRef = await addDoc(collection(db, 'progress_data'), { ...firebaseItem, ...updatedData });
                            allProgressData[itemIndex].firebaseId = docRef.id;
                            localStorage.setItem('satker_progress_data', JSON.stringify(allProgressData));
                            firebaseSuccess = true;
                            console.log('✅ Firebase create successful:', docRef.id);
                        }
                    } catch (firebaseError) {
                        console.error('❌ Firebase save error:', firebaseError);
                        showMessage('⚠️ Data disimpan lokal (Firebase error): ' + firebaseError.message, 'warning');
                }
                
                // Show success message
                if (firebaseSuccess) {
                    showMessage('✅ Data berhasil disimpan ke Firebase!', 'success');
                } else {
                    showMessage('✅ Data disimpan lokal (akan sync ke Firebase saat online)', 'warning');
                }
                
                console.log('✅ Edit completed successfully');

            } catch (error) {
                console.error('❌ Save error:', error);
                showMessage('❌ Error saving: ' + error.message, 'error');
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditId = null;
        }
        
        // Setup link preview handlers for edit modal
        function setupEditLinkPreviewHandlers() {
            const linkFotoBefore = document.getElementById('edit_linkFotoBefore');
            const linkFotoAfter = document.getElementById('edit_linkFotoAfter');
            const linkDokumentasi = document.getElementById('edit_linkDokumentasi');
            
            if (linkFotoBefore) {
                linkFotoBefore.addEventListener('input', (e) => handleEditLinkPreview(e, 'edit_fotoBeforePreview'));
            }
            if (linkFotoAfter) {
                linkFotoAfter.addEventListener('input', (e) => handleEditLinkPreview(e, 'edit_fotoAfterPreview'));
            }
            if (linkDokumentasi) {
                linkDokumentasi.addEventListener('input', (e) => handleEditMultiLinkPreview(e, 'edit_dokumenTambahanPreview'));
            }
        }
        
        // Link preview handlers for edit modal
        function handleEditLinkPreview(event, previewId) {
            const url = event.target.value.trim();
            const previewContainer = document.getElementById(previewId);
            
            if (!url || !isValidUrl(url)) {
                previewContainer.classList.remove('show');
                previewContainer.innerHTML = '';
                return;
            }
            
            // Check if it's an image URL
            if (isImageUrl(url)) {
                previewContainer.innerHTML = `
                    <img src="${url}" alt="Preview" onerror="this.style.display='none'">
                    <div class="link-preview-text">
                        <i class="fas fa-link"></i> ${url}
                    </div>
                `;
                previewContainer.classList.add('show');
            } else {
                previewContainer.innerHTML = `
                    <div class="link-preview-text">
                        <i class="fas fa-file"></i> ${url}
                    </div>
                `;
                previewContainer.classList.add('show');
            }
        }

        function handleEditMultiLinkPreview(event, previewId) {
            const urls = event.target.value.trim().split('\n').filter(url => url.trim());
            const previewContainer = document.getElementById(previewId);
            
            if (!urls.length) {
                previewContainer.classList.remove('show');
                previewContainer.innerHTML = '';
                return;
            }
            
            let previewHtml = '';
            urls.forEach((url, index) => {
                const trimmedUrl = url.trim();
                if (isValidUrl(trimmedUrl)) {
                    if (isImageUrl(trimmedUrl)) {
                        previewHtml += `
                            <div style="margin-bottom: 10px;">
                                <img src="${trimmedUrl}" alt="Preview ${index + 1}" style="max-width: 150px; max-height: 100px; object-fit: cover; border-radius: 4px;" onerror="this.style.display='none'">
                                <div class="link-preview-text">
                                    <i class="fas fa-image"></i> Dokumen ${index + 1}: ${trimmedUrl}
                                </div>
                            </div>
                        `;
                    } else {
                        previewHtml += `
                            <div class="link-preview-text" style="margin-bottom: 8px;">
                                <i class="fas fa-file"></i> Dokumen ${index + 1}: ${trimmedUrl}
                            </div>
                        `;
                    }
                }
            });
            
            if (previewHtml) {
                previewContainer.innerHTML = previewHtml;
                previewContainer.classList.add('show');
            } else {
                previewContainer.classList.remove('show');
                previewContainer.innerHTML = '';
            }
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function isImageUrl(url) {
            return /\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i.test(url);
        }
        
        // Populate documentation in view modal
        function populateViewDocumentation(dokumentasi) {
            const dokumentasiSection = document.getElementById('view_dokumentasiSection');
            const fotoBeforeContainer = document.getElementById('view_fotoBeforeContainer');
            const fotoAfterContainer = document.getElementById('view_fotoAfterContainer');
            const dokumenTambahanContainer = document.getElementById('view_dokumenTambahanContainer');
            
            let hasDocumentation = false;
            
            // Reset containers
            fotoBeforeContainer.style.display = 'none';
            fotoAfterContainer.style.display = 'none';
            dokumenTambahanContainer.style.display = 'none';
            
            if (dokumentasi) {
                // Foto Sebelum
                if (dokumentasi.linkFotoBefore && dokumentasi.linkFotoBefore.trim()) {
                    hasDocumentation = true;
                    fotoBeforeContainer.style.display = 'block';
                    
                    const link = document.getElementById('view_linkFotoBefore');
                    const preview = document.getElementById('view_fotoBeforePreview');
                    
                    link.href = dokumentasi.linkFotoBefore;
                    
                    if (isImageUrl(dokumentasi.linkFotoBefore)) {
                        preview.innerHTML = `<img src="${dokumentasi.linkFotoBefore}" alt="Foto Sebelum" onerror="this.style.display='none'">`;
                    } else {
                        preview.innerHTML = `<div class="link-preview-text"><i class="fas fa-file"></i> ${dokumentasi.linkFotoBefore}</div>`;
                    }
                }
                
                // Foto Sesudah
                if (dokumentasi.linkFotoAfter && dokumentasi.linkFotoAfter.trim()) {
                    hasDocumentation = true;
                    fotoAfterContainer.style.display = 'block';
                    
                    const link = document.getElementById('view_linkFotoAfter');
                    const preview = document.getElementById('view_fotoAfterPreview');
                    
                    link.href = dokumentasi.linkFotoAfter;
                    
                    if (isImageUrl(dokumentasi.linkFotoAfter)) {
                        preview.innerHTML = `<img src="${dokumentasi.linkFotoAfter}" alt="Foto Sesudah" onerror="this.style.display='none'">`;
                    } else {
                        preview.innerHTML = `<div class="link-preview-text"><i class="fas fa-file"></i> ${dokumentasi.linkFotoAfter}</div>`;
                    }
                }
                
                // Dokumentasi Tambahan
                if (dokumentasi.linkDokumentasi && Array.isArray(dokumentasi.linkDokumentasi) && dokumentasi.linkDokumentasi.length > 0) {
                    const validLinks = dokumentasi.linkDokumentasi.filter(link => link && link.trim());
                    
                    if (validLinks.length > 0) {
                        hasDocumentation = true;
                        dokumenTambahanContainer.style.display = 'block';
                        
                        const content = document.getElementById('view_dokumenTambahanContent');
                        let html = '';
                        
                        validLinks.forEach((link, index) => {
                            const trimmedLink = link.trim();
                            const isImage = isImageUrl(trimmedLink);
                            const icon = isImage ? 'fa-image' : 'fa-file';
                            const docName = `Dokumen ${index + 1}`;
                            
                            html += `
                                <div class="view-doc-item">
                                    <div class="view-doc-icon">
                                        <i class="fas ${icon}"></i>
                                    </div>
                                    <div class="view-doc-info">
                                        <div class="view-doc-name">${docName}</div>
                                        <div class="view-doc-url">${trimmedLink}</div>
                                    </div>
                                    <a href="${trimmedLink}" target="_blank" class="view-doc-link" style="margin: 0;">
                                        <i class="fas fa-external-link-alt"></i> Buka
                                    </a>
                                </div>
                            `;
                            
                            if (isImage) {
                                html += `<div class="view-doc-preview" style="margin-bottom: 1rem;"><img src="${trimmedLink}" alt="${docName}" onerror="this.style.display='none'"></div>`;
                            }
                        });
                        
                        content.innerHTML = html;
                    }
                }
            }
            
            // Show/hide documentation section
            dokumentasiSection.style.display = hasDocumentation ? 'block' : 'none';
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = message;
            
            container.appendChild(messageDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        function deleteData(itemId) {
            console.log('Delete data:', itemId);
        }

        function getProgressStatus(progress) {
            if (progress === 0) return { text: 'Belum Mulai', class: 'status-belum-mulai' };
            if (progress < 25) return { text: 'Tahap Awal', class: 'status-tahap-awal' };
            if (progress < 75) return { text: 'Berjalan Normal', class: 'status-berjalan' };
            if (progress < 100) return { text: 'Hampir Selesai', class: 'status-hampir-selesai' };
            return { text: 'Selesai', class: 'status-selesai' };
        }

        function closeViewModal() {
            document.getElementById('viewModal').style.display = 'none';
        }

        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                window.location.href = 'login.html';
            }
        }


        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const satkerFilter = document.getElementById('satkerFilter').value;
            const lokasiFilter = document.getElementById('lokasiFilter').value;
            const picFilter = document.getElementById('picFilter').value;
            const progressFilter = document.getElementById('progressFilter').value;
            
            filteredData = allProgressData.filter(item => {
                // Search filter - Enhanced with more fields
                const matchesSearch = !searchTerm || 
                    (item.namaKegiatan && item.namaKegiatan.toLowerCase().includes(searchTerm)) ||
                    (item.namaPaket && item.namaPaket.toLowerCase().includes(searchTerm)) ||
                    (item.indikator && item.indikator.toLowerCase().includes(searchTerm)) ||
                    (item.kegiatan && item.kegiatan.toLowerCase().includes(searchTerm)) ||
                    (item.lokasi && item.lokasi.toLowerCase().includes(searchTerm)) ||
                    (item.lokasiKegiatan && item.lokasiKegiatan.toLowerCase().includes(searchTerm)) ||
                    (item.picProgram && item.picProgram.toLowerCase().includes(searchTerm)) ||
                    (item.pic && item.pic.toLowerCase().includes(searchTerm)) ||
                    (item.penyedia && item.penyedia.toLowerCase().includes(searchTerm)) ||
                    (item.noKontrak && item.noKontrak.toLowerCase().includes(searchTerm)) ||
                    (item.kodeKegiatan && item.kodeKegiatan.toLowerCase().includes(searchTerm)) ||
                    (item.satkerName && item.satkerName.toLowerCase().includes(searchTerm)) ||
                    (item.paguAnggaran && item.paguAnggaran.toString().includes(searchTerm));
                
                // Satker filter
                const matchesSatker = !satkerFilter || 
                    (item.satkerCode && item.satkerCode === satkerFilter) ||
                    (item.satkerName && item.satkerName.toLowerCase().includes(satkerFilter.toLowerCase()));
                
                // Lokasi filter
                const matchesLokasi = !lokasiFilter || 
                    (item.lokasi && item.lokasi.toLowerCase().includes(lokasiFilter.toLowerCase())) ||
                    (item.lokasiKegiatan && item.lokasiKegiatan.toLowerCase().includes(lokasiFilter.toLowerCase()));
                
                // PIC filter
                const matchesPIC = !picFilter || 
                    (item.picProgram && item.picProgram.trim().toUpperCase() === picFilter.trim().toUpperCase()) ||
                    (item.pic && item.pic.trim().toUpperCase() === picFilter.trim().toUpperCase());
                
                // Progress filter
                const progress = parseFloat(item.progressFisik) || 0;
                let matchesProgress = true;
                if (progressFilter) {
                    if (progressFilter === '0') {
                        matchesProgress = progress === 0;
                    } else if (progressFilter === '1-25') {
                        matchesProgress = progress > 0 && progress <= 25;
                    } else if (progressFilter === '26-50') {
                        matchesProgress = progress > 25 && progress <= 50;
                    } else if (progressFilter === '51-75') {
                        matchesProgress = progress > 50 && progress <= 75;
                    } else if (progressFilter === '76-99') {
                        matchesProgress = progress > 75 && progress < 100;
                    } else if (progressFilter === '100') {
                        matchesProgress = progress === 100;
                    }
                }
                
                return matchesSearch && matchesSatker && matchesLokasi && matchesPIC && matchesProgress;
            });
            
            updateStatistics();
            displayData();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const viewModal = document.getElementById('viewModal');
            const editModal = document.getElementById('editModal');
            
            if (event.target === viewModal) {
                closeViewModal();
            }
            if (event.target === editModal) {
                closeEditModal();
            }
        }

        // Handle escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeViewModal();
                closeEditModal();
            }
        });

        // Make functions globally available
        window.loadData = loadData;
        window.refreshData = loadData;
        window.filterData = filterData;
        window.displayData = displayData;
        window.updateStatistics = updateStatistics;
        window.formatCurrency = formatCurrency;
        window.viewData = viewData;
        window.editData = editData;
        window.deleteData = deleteData;
        window.closeViewModal = closeViewModal;
        window.closeEditModal = closeEditModal;
        window.saveEditData = saveEditData;
        window.logout = logout;
    </script>

    <!-- Footer dengan Branding TC-More -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-branding">
                <div class="footer-title">TC-More</div>
                <div class="footer-subtitle">Trans Continuous Monitoring & Reporting</div>
                <div class="footer-org">Inspektorat Jenderal Kementerian Transmigrasi RI</div>
            </div>
            <div class="footer-divider"></div>
            <div class="footer-copyright">
                © 2024 Inspektorat Jenderal Kementerian Transmigrasi RI. Semua hak dilindungi.
            </div>
        </div>
    </footer>

</body>
</html>
